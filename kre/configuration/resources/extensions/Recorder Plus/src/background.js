(function(){"use strict";var pe=(t=>(t.MESSAGE="message",t.CONNECTED="connected",t.DISCONNECTED="disconnected",t.ERROR="error",t.OPEN="open",t.REQUEST="request",t.RESPONSE="response",t.CONNECTION="connection",t))(pe||{});function lr(t,e,r=()=>!0){return t.find(n=>n.type===e&&r(n))}const dr=(t,e)=>t===e;function ur(t,e,r=dr,n){const s=t;return e.forEach(i=>{const o=s.findIndex(c=>r(i,c));o>=0&&s.splice(o,1)}),s}const Ee=globalThis||void 0||self;var hr=typeof Ee=="object"&&Ee&&Ee.Object===Object&&Ee,fr=typeof self=="object"&&self&&self.Object===Object&&self,Ie=hr||fr||Function("return this")(),J=Ie.Symbol,lt=Object.prototype,gr=lt.hasOwnProperty,mr=lt.toString,ce=J?J.toStringTag:void 0;function pr(t){var e=gr.call(t,ce),r=t[ce];try{t[ce]=void 0;var n=!0}catch{}var s=mr.call(t);return n&&(e?t[ce]=r:delete t[ce]),s}var Er=Object.prototype,br=Er.toString;function Ar(t){return br.call(t)}var vr="[object Null]",Tr="[object Undefined]",dt=J?J.toStringTag:void 0;function ke(t){return t==null?t===void 0?Tr:vr:dt&&dt in Object(t)?pr(t):Ar(t)}function Fe(t){return t!=null&&typeof t=="object"}var _r="[object Symbol]";function Ve(t){return typeof t=="symbol"||Fe(t)&&ke(t)==_r}function yr(t,e){for(var r=-1,n=t==null?0:t.length,s=Array(n);++r<n;)s[r]=e(t[r],r,t);return s}var be=Array.isArray,ut=J?J.prototype:void 0,ht=ut?ut.toString:void 0;function ft(t){if(typeof t=="string")return t;if(be(t))return yr(t,ft)+"";if(Ve(t))return ht?ht.call(t):"";var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}function gt(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var wr="[object AsyncFunction]",Rr="[object Function]",Sr="[object GeneratorFunction]",Nr="[object Proxy]";function Cr(t){if(!gt(t))return!1;var e=ke(t);return e==Rr||e==Sr||e==wr||e==Nr}var De=Ie["__core-js_shared__"],mt=function(){var t=/[^.]+$/.exec(De&&De.keys&&De.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function Mr(t){return!!mt&&mt in t}var Lr=Function.prototype,xr=Lr.toString;function Pr(t){if(t!=null){try{return xr.call(t)}catch{}try{return t+""}catch{}}return""}var Or=/[\\^$.*+?()[\]{}|]/g,Ir=/^\[object .+?Constructor\]$/,kr=Function.prototype,Fr=Object.prototype,Vr=kr.toString,Dr=Fr.hasOwnProperty,Hr=RegExp("^"+Vr.call(Dr).replace(Or,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Br(t){if(!gt(t)||Mr(t))return!1;var e=Cr(t)?Hr:Ir;return e.test(Pr(t))}function Ur(t,e){return t?.[e]}function pt(t,e){var r=Ur(t,e);return Br(r)?r:void 0}var jr=9007199254740991,Gr=/^(?:0|[1-9]\d*)$/;function Yr(t,e){var r=typeof t;return e=e??jr,!!e&&(r=="number"||r!="symbol"&&Gr.test(t))&&t>-1&&t%1==0&&t<e}function qr(t,e){return t===e||t!==t&&e!==e}var $r=9007199254740991;function Wr(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=$r}var zr="[object Arguments]";function Et(t){return Fe(t)&&ke(t)==zr}var bt=Object.prototype,Qr=bt.hasOwnProperty,Xr=bt.propertyIsEnumerable,Kr=Et(function(){return arguments}())?Et:function(t){return Fe(t)&&Qr.call(t,"callee")&&!Xr.call(t,"callee")},Jr=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Zr=/^\w*$/;function en(t,e){if(be(t))return!1;var r=typeof t;return r=="number"||r=="symbol"||r=="boolean"||t==null||Ve(t)?!0:Zr.test(t)||!Jr.test(t)||e!=null&&t in Object(e)}var le=pt(Object,"create");function tn(){this.__data__=le?le(null):{},this.size=0}function rn(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var nn="__lodash_hash_undefined__",sn=Object.prototype,on=sn.hasOwnProperty;function an(t){var e=this.__data__;if(le){var r=e[t];return r===nn?void 0:r}return on.call(e,t)?e[t]:void 0}var cn=Object.prototype,ln=cn.hasOwnProperty;function dn(t){var e=this.__data__;return le?e[t]!==void 0:ln.call(e,t)}var un="__lodash_hash_undefined__";function hn(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=le&&e===void 0?un:e,this}function $(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}$.prototype.clear=tn,$.prototype.delete=rn,$.prototype.get=an,$.prototype.has=dn,$.prototype.set=hn;function fn(){this.__data__=[],this.size=0}function Ae(t,e){for(var r=t.length;r--;)if(qr(t[r][0],e))return r;return-1}var gn=Array.prototype,mn=gn.splice;function pn(t){var e=this.__data__,r=Ae(e,t);if(r<0)return!1;var n=e.length-1;return r==n?e.pop():mn.call(e,r,1),--this.size,!0}function En(t){var e=this.__data__,r=Ae(e,t);return r<0?void 0:e[r][1]}function bn(t){return Ae(this.__data__,t)>-1}function An(t,e){var r=this.__data__,n=Ae(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this}function Z(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Z.prototype.clear=fn,Z.prototype.delete=pn,Z.prototype.get=En,Z.prototype.has=bn,Z.prototype.set=An;var vn=pt(Ie,"Map");function Tn(){this.size=0,this.__data__={hash:new $,map:new(vn||Z),string:new $}}function _n(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function ve(t,e){var r=t.__data__;return _n(e)?r[typeof e=="string"?"string":"hash"]:r.map}function yn(t){var e=ve(this,t).delete(t);return this.size-=e?1:0,e}function wn(t){return ve(this,t).get(t)}function Rn(t){return ve(this,t).has(t)}function Sn(t,e){var r=ve(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this}function W(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}W.prototype.clear=Tn,W.prototype.delete=yn,W.prototype.get=wn,W.prototype.has=Rn,W.prototype.set=Sn;var Nn="Expected a function";function He(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(Nn);var r=function(){var n=arguments,s=e?e.apply(this,n):n[0],i=r.cache;if(i.has(s))return i.get(s);var o=t.apply(this,n);return r.cache=i.set(s,o)||i,o};return r.cache=new(He.Cache||W),r}He.Cache=W;var Cn=500;function Mn(t){var e=He(t,function(n){return r.size===Cn&&r.clear(),n}),r=e.cache;return e}var Ln=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,xn=/\\(\\)?/g,Pn=Mn(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(Ln,function(r,n,s,i){e.push(s?i.replace(xn,"$1"):n||r)}),e});function On(t){return t==null?"":ft(t)}function At(t,e){return be(t)?t:en(t,e)?[t]:Pn(On(t))}function vt(t){if(typeof t=="string"||Ve(t))return t;var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}function In(t,e){e=At(e,t);for(var r=0,n=e.length;t!=null&&r<n;)t=t[vt(e[r++])];return r&&r==n?t:void 0}function Be(t,e,r){var n=t==null?void 0:In(t,e);return n===void 0?r:n}function kn(t,e,r){e=At(e,t);for(var n=-1,s=e.length,i=!1;++n<s;){var o=vt(e[n]);if(!(i=t!=null&&r(t,o)))break;t=t[o]}return i||++n!=s?i:(s=t==null?0:t.length,!!s&&Wr(s)&&Yr(o,s)&&(be(t)||Kr(t)))}var Fn=Object.prototype,Vn=Fn.hasOwnProperty;function Dn(t,e){return t!=null&&Vn.call(t,e)}function Hn(t,e){return t!=null&&kn(t,e,Dn)}function U(t){const e=t;return!e||typeof e!="object"?e:{...e,message:e.message,stack:e.stack,name:e.name,cause:U(e.cause)}}function Te(t){if(t==null||t instanceof Error)return t;if(typeof t=="object"){const r=U(t),n=new Error(r.message);return Object.assign(n,r),n.stack=r.stack,n.name=r.name,n.cause=r.cause,n}const e=new Error(String(t));return Bn(e),e}function Bn(t,e){const s=t.stack;if(s){const i=s.split(`
    at `);i.splice(1,1),t.stack=i.join(`
    at `)}return t}var Un=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function jn(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Ue={exports:{}},ee=typeof Reflect=="object"?Reflect:null,Tt=ee&&typeof ee.apply=="function"?ee.apply:function(e,r,n){return Function.prototype.apply.call(e,r,n)},_e;ee&&typeof ee.ownKeys=="function"?_e=ee.ownKeys:Object.getOwnPropertySymbols?_e=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:_e=function(e){return Object.getOwnPropertyNames(e)};function Gn(t){console&&console.warn&&console.warn(t)}var _t=Number.isNaN||function(e){return e!==e};function b(){b.init.call(this)}Ue.exports=b,Ue.exports.once=Wn,b.EventEmitter=b,b.prototype._events=void 0,b.prototype._eventsCount=0,b.prototype._maxListeners=void 0;var yt=10;function ye(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(b,"defaultMaxListeners",{enumerable:!0,get:function(){return yt},set:function(t){if(typeof t!="number"||t<0||_t(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");yt=t}}),b.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},b.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||_t(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function wt(t){return t._maxListeners===void 0?b.defaultMaxListeners:t._maxListeners}b.prototype.getMaxListeners=function(){return wt(this)},b.prototype.emit=function(e){for(var r=[],n=1;n<arguments.length;n++)r.push(arguments[n]);var s=e==="error",i=this._events;if(i!==void 0)s=s&&i.error===void 0;else if(!s)return!1;if(s){var o;if(r.length>0&&(o=r[0]),o instanceof Error)throw o;var c=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw c.context=o,c}var l=i[e];if(l===void 0)return!1;if(typeof l=="function")Tt(l,this,r);else for(var g=l.length,E=Mt(l,g),n=0;n<g;++n)Tt(E[n],this,r);return!0};function Rt(t,e,r,n){var s,i,o;if(ye(r),i=t._events,i===void 0?(i=t._events=Object.create(null),t._eventsCount=0):(i.newListener!==void 0&&(t.emit("newListener",e,r.listener?r.listener:r),i=t._events),o=i[e]),o===void 0)o=i[e]=r,++t._eventsCount;else if(typeof o=="function"?o=i[e]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),s=wt(t),s>0&&o.length>s&&!o.warned){o.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=t,c.type=e,c.count=o.length,Gn(c)}return t}b.prototype.addListener=function(e,r){return Rt(this,e,r,!1)},b.prototype.on=b.prototype.addListener,b.prototype.prependListener=function(e,r){return Rt(this,e,r,!0)};function Yn(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function St(t,e,r){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},s=Yn.bind(n);return s.listener=r,n.wrapFn=s,s}b.prototype.once=function(e,r){return ye(r),this.on(e,St(this,e,r)),this},b.prototype.prependOnceListener=function(e,r){return ye(r),this.prependListener(e,St(this,e,r)),this},b.prototype.removeListener=function(e,r){var n,s,i,o,c;if(ye(r),s=this._events,s===void 0)return this;if(n=s[e],n===void 0)return this;if(n===r||n.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,n.listener||r));else if(typeof n!="function"){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===r||n[o].listener===r){c=n[o].listener,i=o;break}if(i<0)return this;i===0?n.shift():qn(n,i),n.length===1&&(s[e]=n[0]),s.removeListener!==void 0&&this.emit("removeListener",e,c||r)}return this},b.prototype.off=b.prototype.removeListener,b.prototype.removeAllListeners=function(e){var r,n,s;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var i=Object.keys(n),o;for(s=0;s<i.length;++s)o=i[s],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=n[e],typeof r=="function")this.removeListener(e,r);else if(r!==void 0)for(s=r.length-1;s>=0;s--)this.removeListener(e,r[s]);return this};function Nt(t,e,r){var n=t._events;if(n===void 0)return[];var s=n[e];return s===void 0?[]:typeof s=="function"?r?[s.listener||s]:[s]:r?$n(s):Mt(s,s.length)}b.prototype.listeners=function(e){return Nt(this,e,!0)},b.prototype.rawListeners=function(e){return Nt(this,e,!1)},b.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):Ct.call(t,e)},b.prototype.listenerCount=Ct;function Ct(t){var e=this._events;if(e!==void 0){var r=e[t];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}b.prototype.eventNames=function(){return this._eventsCount>0?_e(this._events):[]};function Mt(t,e){for(var r=new Array(e),n=0;n<e;++n)r[n]=t[n];return r}function qn(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function $n(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}function Wn(t,e){return new Promise(function(r,n){function s(o){t.removeListener(e,i),n(o)}function i(){typeof t.removeListener=="function"&&t.removeListener("error",s),r([].slice.call(arguments))}Lt(t,e,i,{once:!0}),e!=="error"&&zn(t,s,{once:!0})})}function zn(t,e,r){typeof t.on=="function"&&Lt(t,"error",e,r)}function Lt(t,e,r,n){if(typeof t.on=="function")n.once?t.once(e,r):t.on(e,r);else if(typeof t.addEventListener=="function")t.addEventListener(e,function s(i){n.once&&t.removeEventListener(e,s),r(i)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var xt=Ue.exports;class z{emitter=new xt.EventEmitter;#e=new Map;#t={};constructor(){this.emitter.setMaxListeners(1/0)}#r(e,...r){e.call(this.emitter,...r)}setMaxListeners(e){return this.emitter.setMaxListeners(e)}getMaxListeners(){return this.emitter.getMaxListeners()}eventNames(){return this.emitter.eventNames()}emit(e,r){const n=e instanceof Object?e:{type:e,...r},i=this.getHooks(n.type).reduce((o,c)=>c(o),n)||{type:n.type};return this.emitter.emit("*",i),this.emitter.emit(n.type,i)}emitEvent(e){return this.emit(e.type,e)}addListener(e,r){this.on(e,r)}on(e,r){this.#r(this.emitter.on,e,r)}once(e,r){this.#r(this.emitter.once,e,r)}prependListener(e,r){this.#r(this.emitter.prependListener,e,r)}prependOnceListener(e,r){this.#r(this.emitter.prependOnceListener,e,r)}removeListener(e,r){this.off(e,r)}off(e,r){this.#r(this.emitter.off,e,r)}removeAllListeners(e){this.emitter.removeAllListeners(e==="*"?void 0:e)}listeners(e){return this.emitter.listeners(e)}listenerCount(e){return this.emitter.listenerCount(e)}rawListeners(e){return this.emitter.rawListeners(e)}pipe(e){this.unpipe(e);const r=n=>{e.emit(n.type,n)};this.#e.set(e,r),this.on("*",r)}unpipe(e){const r=this.#e.get(e);r&&this.off("*",r)}hook(e,r){this.unhook(e,r);const n=this.#t[e]||[];this.#t[e]=n,n.push(r)}unhook(e,r){const n=this.#t[e]||[],s=n.indexOf(r);s>0&&n.splice(s,1)}getHooks(e){this.#t[e]||(this.#t[e]=[]);const r=this.#t["*"]??[],n=this.#t[e];return[...new Set([...r,...n||[]])]}}function Qn(){const t={},e=new Promise((r,n)=>{t.resolve=r,t.reject=n});return t.promise=e,t}async function Xn(t){return t}const Kn=(t,e)=>{const r=(Array.isArray(e)?e:typeof e=="string"?e.split("."):[]).slice(0,-1);return Be(t,r)||t},je=new Map;setInterval(()=>{je.forEach((t,e)=>{t.deref()||(e(),je.delete(e))})},1e3);function Jn(t,e){if(!(t&&(typeof t=="object"||typeof t=="function")))return null;const r=new WeakRef(t);return je.set(e,r),r}function Zn(t){return(Array.isArray(t)?t:typeof t=="string"?t.split("."):[t]).pop()}function Pt(t,e,r){const n=Kn(t,e),s=Zn(e);return n[s](...r)}function es(t){return t.replace(/^add/,"remove").replace(/^on|^once/,"off")}class ts{listeners=[];storeListener(e){this.listeners.push(e)}with(e){return new Proxy(e,{get:(r,n)=>{let s=r[n];return typeof n=="string"&&/(^add\w*?Listener$|^on\w*$)/.test(n)&&(s=(...o)=>{this.storeListener({addMethod:n,args:o,target:r}),r[n]?.(...o)}),s}})}async removeAllListeners(){await Promise.allSettled([...this.listeners].map(e=>this.removeListenerRecord(e)))}async removeListenerRecord(e){const r=es(e.addMethod);await Pt(e.target,r,e.args),ur(this.listeners,[e])}}const j=9007199254740992,we=j-1,Re=-1>>>0,V=Re+1,Ge=V/2,de=1<<21,Q=de-1;function rs(t){return t.next()|0}function X(t,e){return e===0?t:r=>t(r)+e}function Ot(t){const e=t.next()|0,r=t.next()>>>0;return(e&Q)*V+r+(e&de?-9007199254740992:0)}function ns(t){for(;;){const e=t.next()|0;if(e&4194304){if((e&8388607)===4194304&&!(t.next()|0))return j}else{const r=t.next()>>>0;return(e&Q)*V+r+(e&de?-9007199254740992:0)}}}function ss(t){return t.next()>>>0}function is(t){const e=t.next()&Q,r=t.next()>>>0;return e*V+r}function os(t){for(;;){const e=t.next()|0;if(e&de){if(!(e&Q)&&!(t.next()|0))return j}else{const r=t.next()>>>0;return(e&Q)*V+r}}}function It(t){return(t+1&t)===0}function as(t){return e=>e.next()&t}function cs(t){const e=t+1,r=e*Math.floor(V/e);return n=>{let s=0;do s=n.next()>>>0;while(s>=r);return s%e}}function ls(t){return It(t)?as(t):cs(t)}function ds(t){return(t|0)===0}function us(t){return e=>{const r=e.next()&t,n=e.next()>>>0;return r*V+n}}function hs(t){const e=t*Math.floor(j/t);return r=>{let n=0;do{const s=r.next()&Q,i=r.next()>>>0;n=s*V+i}while(n>=e);return n%t}}function fs(t){const e=t+1;if(ds(e)){const r=(e/V|0)-1;if(It(r))return us(r)}return hs(e)}function kt(t,e){return r=>{let n=0;do{const s=r.next()|0,i=r.next()>>>0;n=(s&Q)*V+i+(s&de?-9007199254740992:0)}while(n<t||n>e);return n}}function Ft(t,e){if(t=Math.floor(t),e=Math.floor(e),t<-9007199254740992||!isFinite(t))throw new RangeError(`Expected min to be at least ${-9007199254740992}`);if(e>j||!isFinite(e))throw new RangeError(`Expected max to be at most ${j}`);const r=e-t;return r<=0||!isFinite(r)?()=>t:r===Re?t===0?ss:X(rs,t+Ge):r<Re?X(ls(r),t):r===we?X(is,t):r<we?X(fs(r),t):e-1-t===we?X(os,t):t===-9007199254740992&&e===j?ns:t===-9007199254740992&&e===we?Ot:t===-9007199254740991&&e===j?X(Ot,1):e===j?X(kt(t-1,e-1),1):kt(t,e)}const gs="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_-";function Vt(t=gs){const e=t.length;if(!e)throw new Error("Expected pool not to be an empty string");const r=Ft(0,e-1);return(n,s)=>{let i="";for(let o=0;o<s;++o){const c=r(n);i+=t.charAt(c)}return i}}const Dt="0123456789abcdef",ms=Vt(Dt),ps=Vt(Dt.toUpperCase());function Es(t){return t?ps:ms}(()=>{try{if("x".repeat(3)==="xxx")return(t,e)=>t.repeat(e)}catch{}return(t,e)=>{let r="";for(;e>0;)e&1&&(r+=t),e>>=1,t+=t;return r}})();const bs={next(){return Math.random()*V|0}};(()=>{try{const t=new ArrayBuffer(4),e=new Int32Array(t);if(e[0]=Ge,e[0]===-Ge)return Int32Array}catch{}return Array})(),(()=>{try{if(Math.imul(Re,5)===-5)return Math.imul}catch{}const t=65535;return(e,r)=>{const n=e>>>16&t,s=e&t,i=r>>>16&t,o=r&t;return s*o+(n*o+s*i<<16>>>0)|0}})();for(var w=[],Ye=0;Ye<256;++Ye)w.push((Ye+256).toString(16).slice(1));function Ht(t,e=0){return(w[t[e+0]]+w[t[e+1]]+w[t[e+2]]+w[t[e+3]]+"-"+w[t[e+4]]+w[t[e+5]]+"-"+w[t[e+6]]+w[t[e+7]]+"-"+w[t[e+8]]+w[t[e+9]]+"-"+w[t[e+10]]+w[t[e+11]]+w[t[e+12]]+w[t[e+13]]+w[t[e+14]]+w[t[e+15]]).toLowerCase()}var Se,As=new Uint8Array(16);function Bt(){if(!Se&&(Se=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Se))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Se(As)}var qe,Ne,$e=0,We=0;function vs(t,e,r){var n=0,s=new Array(16);t=t||{};var i=t.node,o=t.clockseq;if(t._v6||(i||(i=qe),o==null&&(o=Ne)),i==null||o==null){var c=t.random||(t.rng||Bt)();i==null&&(i=[c[0],c[1],c[2],c[3],c[4],c[5]],!qe&&!t._v6&&(i[0]|=1,qe=i)),o==null&&(o=(c[6]<<8|c[7])&16383,Ne===void 0&&!t._v6&&(Ne=o))}var l=t.msecs!==void 0?t.msecs:Date.now(),g=t.nsecs!==void 0?t.nsecs:We+1,E=l-$e+(g-We)/1e4;if(E<0&&t.clockseq===void 0&&(o=o+1&16383),(E<0||l>$e)&&t.nsecs===void 0&&(g=0),g>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");$e=l,We=g,Ne=o,l+=122192928e5;var R=((l&268435455)*1e4+g)%4294967296;s[n++]=R>>>24&255,s[n++]=R>>>16&255,s[n++]=R>>>8&255,s[n++]=R&255;var C=l/4294967296*1e4&268435455;s[n++]=C>>>8&255,s[n++]=C&255,s[n++]=C>>>24&15|16,s[n++]=C>>>16&255,s[n++]=o>>>8|128,s[n++]=o&255;for(var I=0;I<6;++I)s[n+I]=i[I];return e||Ht(s)}var Ts=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const Ut={randomUUID:Ts};function _s(t,e,r){if(Ut.randomUUID&&!t)return Ut.randomUUID();t=t||{};var n=t.random||(t.rng||Bt)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,Ht(n)}var ys={utf8:{},bin:{}},jt=ys;(function(){jt.utf8,jt.bin})();const Gt=bs;function ws(t=8,e=!1){return Es(e)(Gt,t)}function Ce(t=4){return t===1?vs():_s()}function Rs(t,e){return Ft(t,e)(Gt)}function Ss(){const t=Date.now()%500;for(let e=0;e<t;e++)Rs(0,100)}Ss();function te(t,e=!1){return JSON.stringify(t,(r,n)=>n instanceof RegExp?String(n):n,e?2:void 0)}function Ns(t){return t==null||!["object","function"].includes(typeof t)}const Cs=void 0;function re(t){return t.handler!==void 0}function ze(t,...e){return e.map(r=>re(r)?{...r,behavior:t}:{handler:r,behavior:t})}function Yt(t={}){return{params:t,results:{},errors:[]}}function Ms(t,e,r){const n=r?.persistentParams,s=r?.persistentResults;n&&n.forEach(i=>{t.params[i]=e.params[i]}),s&&s.forEach(i=>{t.results[i]=e.results[i]})}async function Ls(t,e){typeof t=="function"?await t(e):await t.handler(e)}class qt extends z{constructor(e=[]){super(),this.handlers=e}pushHandlers(...e){this.handlers.push(...e)}}var M=(t=>(t.PIPELINE_STARTED="pipeline:started",t.PIPELINE_ENDED="pipeline:ended",t.ROUND_STARTED="round:started",t.ROUND_ENDED="round:ended",t.HANDLER_STARTED="handler:started",t.HANDLER_ENDED="handler:ended",t.SETUP_STARTED="setup:started",t.SETUP_ENDED="setup:ended",t.TEARDOWN_STARTED="teardown:started",t.TEARDOWN_ENDED="teardown:ended",t.ABORTED="aborted",t))(M||{});class $t extends Error{constructor(){super("Rerun pipeline")}}class Wt extends Error{constructor(){super("Rerun handler")}}class zt extends Error{constructor(e){super("Goto handler"),this.handler=e}}class Qe extends Error{reason;constructor(e){super("Skip"),this.reason=U(e)}}function xs(t){return t[Symbol.iterator]()}class Ps extends qt{constructor(e,r,n,s){super(s),this.pipeline=e,this.context=r,this.prevContext=n,this.run=this.run.bind(this)}abortController=new AbortController;times=0;get isFirstTime(){return this.times===1}getContext(){return this.context}handlerParamsProvider(){return{context:this.context,params:this.context.params,results:this.context.results,prevContext:this.context,subPipeline:this,pipeLine:this.pipeline}}getHandlers(){const e=[],r=[],n=[],s=[];return this.handlers.forEach(i=>{const o=re(i);o&&i.behavior==="setup"?r.push(i):o&&i.behavior==="teardown"?n.push(i):o&&i.behavior==="error"?s.push(i):e.push(i)}),{mainHandlers:e,setupHandlers:r,teardownHandlers:n,errorHandlers:s}}getMainHandlers(){return this.handlers.filter(e=>!re(e))}getErrorHandlers(){return this.handlers.filter(e=>re(e)&&e.behavior==="error")}reset(){this.abortController=new AbortController}async handleError(e){this.getContext().error=Te(U(e)),await this.runHandlers(this.getErrorHandlers())}requestRerun(){throw new $t}requestRerunHandler(){throw new Wt}requestSkip(e){throw new Qe(e)}requestGotoHandler(e){const r=this.handlers.find(n=>re(n)&&n.key===e);throw r?new zt(r):new Error(`Handler "${e}" not found`)}abort(){this.abortController.abort(),this.emit(M.ABORTED),this.requestSkip()}async runHandler(e){do{try{const r=this.handlerParamsProvider(),n=re(e),s=n&&e.firtTimeOnly,i=n&&e.condition;if(s&&this.times>1||i&&!e.condition?.(r))return;this.emit(M.HANDLER_STARTED,{type:M.HANDLER_STARTED,handler:e}),await Ls(e,r)}catch(r){if(r instanceof Wt)continue;throw r}finally{this.emit(M.HANDLER_ENDED,{type:M.HANDLER_ENDED,handler:e})}return}while(!0)}async runHandlers(e,r=!1){const n=xs(e);let s;for(let i=n.next().value;i;){if(s){if(i!==s){i=n.next().value;continue}s=void 0}try{await this.runHandler(i)}catch(o){if(!r&&o instanceof zt){s=o.handler;continue}if(r&&o instanceof Qe)return;throw o}i=n.next().value}}async runRound(){const{mainHandlers:e,setupHandlers:r,teardownHandlers:n}=this.getHandlers();let s=!1;do{s=!1,this.reset(),this.emit(M.ROUND_STARTED),this.times++;try{this.emit(M.SETUP_STARTED),await this.runHandlers(r),this.emit(M.SETUP_ENDED),await this.runHandlers(e)}catch(i){if(i instanceof $t)s=!0;else if(!(i instanceof Qe))try{await this.handleError(i)}catch(o){console.warn("> Errors during the error handling phase:",o)}}finally{this.emit(M.TEARDOWN_STARTED),await this.runHandlers(n),this.emit(M.TEARDOWN_ENDED)}this.emit(M.ROUND_ENDED)}while(s);if(this.getContext().error)throw this.getContext().error}async run(){try{this.emit(M.PIPELINE_STARTED),await this.runRound()}finally{this.emit(M.PIPELINE_ENDED)}return this.context}}class Os extends qt{prevContext=Yt();subPipelineProvider({context:e,prevContext:r,handlers:n}){return new Ps(this,e,r,n)}schedule(e){const{handlers:r}=e||{},n=[...this.handlers,...r||[]],{params:s}=e||{},i=Yt(s);Ms(i,this.prevContext,e?.options);const o=this.subPipelineProvider({context:i,prevContext:this.prevContext,handlers:n});return o.pipeline=this,o}async run(e){const n=await this.schedule(e).run();return this.prevContext=n,n}async runAndReturnMainResult(e){return(await this.run(e)).mainResult}}class Is extends Os{get allHandlers(){return[...this.setupHandlers,...this.beforePreHandlers,...this.preHandlers,...this.afterPreHandlers,...this.beforeMainHandlers,...this.mainHandlers,...this.afterMainHandlers,...this.beforePostHandlers,...this.postHandlers,...this.afterPostHandlers,...this.teardownHandlers,...this.errorHandlers]}setupHandlers=[];teardownHandlers=[];errorHandlers=[];beforePreHandlers=[];preHandlers=[];afterPreHandlers=[];beforeMainHandlers=[];mainHandlers=[];afterMainHandlers=[];beforePostHandlers=[];postHandlers=[];afterPostHandlers=[];registerSetupHandlers(...e){this.setupHandlers.push(...e)}registerTeardownHandlers(...e){this.teardownHandlers.push(...e)}registerErrorHandlers(...e){this.errorHandlers.push(...e)}registerBeforePreHandler(...e){this.beforePreHandlers.push(...e)}registerPreHandler(...e){this.preHandlers.push(...e)}registerAfterPreHandler(...e){this.afterPreHandlers.push(...e)}registerBeforeMainHandler(...e){this.beforeMainHandlers.push(...e)}registerMainHandler(...e){this.mainHandlers.push(...e)}registerAfterMainHandler(...e){this.afterMainHandlers.push(...e)}registerBeforePostHandler(...e){this.beforePostHandlers.push(...e)}registerPostHandler(...e){this.postHandlers.push(...e)}registerAfterPostHandler(...e){this.afterPostHandlers.push(...e)}wrapHandlers(...e){return[...ze("setup",...this.setupHandlers),...this.beforePreHandlers,...this.preHandlers,...this.afterPreHandlers,...this.beforeMainHandlers,...this.mainHandlers,...e,...this.afterMainHandlers,...this.beforePostHandlers,...this.postHandlers,...this.afterPostHandlers,...ze("teardown",...this.teardownHandlers),...ze("error",...this.errorHandlers)]}schedule(e){return e||(e={}),e.handlers=this.wrapHandlers(...e.handlers||[]),super.schedule(e)}}class ks{emitter=new xt.EventEmitter;addConnectionListener(e){this.emitter.addListener(pe.CONNECTION,e)}removeConnectionListener(e){this.emitter.removeListener(pe.CONNECTION,e)}notifyConnection(e){this.emitter.emit(pe.CONNECTION,e)}}class Fs extends ks{}class Xe extends z{get transportName(){return"base"}connected=!1;connecting=!1;connectPromise;get isConnected(){return this.connected}get isConnecting(){return this.connecting}constructor(){super(),this.handleRawMessage=this.handleRawMessage.bind(this),this.notifyConnected=this.notifyConnected.bind(this),this.handleReconnected=this.handleReconnected.bind(this),this.handleDisconnected=this.handleDisconnected.bind(this),this.notifyDisconnected=this.notifyDisconnected.bind(this),this.setMaxListeners(30)}setupListeners(){this.detachListeners(),this.attachListeners()}attachListeners(){}detachListeners(){}async connect(...e){if(!this.connected)return this.connecting?this.connectPromise.promise:(this.connecting=!0,this.connectPromise=Qn(),this.pureConnect(...e).then(()=>{this.setupConnection(),this.connectPromise.resolve()}).catch(r=>{this.connectPromise.reject(r),this.emit("error",{error:Te(r)})}).finally(()=>{this.connecting=!1}),this.connectPromise.promise)}setupConnection(){this.connected=!0,this.setupListeners(),this.notifyConnected()}async pureConnect(...e){}handleReconnected(){this.setupConnection()}disconnect(...e){this.detachListeners(),this.connected=!1,this.connecting=!1,this.pureDisconnect()}pureDisconnect(...e){}handleDisconnected(){this.connected=!1,this.connecting=!1,this.detachListeners(),this.notifyDisconnected()}sendMessage(e){if(!this.isConnected)throw new Error("The transport is not connected");return this.sendRawMessage(this.serializeMessage(e))}serializeMessage(e){return e}handleRawMessage(e){!this.isConnected||!this.verifyRawMessage(e)||this.dispatchMessage(this.deserializeMessage(e))}verifyRawMessage(e){return!0}deserializeMessage(e){return e}addMessageListener(e){this.addListener("message",e)}removeMessageListener(e){this.removeListener("message",e)}dispatchMessage(e){this.emit("message",{message:e,transportName:this.transportName})}addConnectListener(e){this.addListener("connected",e)}removeConnectListener(e){this.removeListener("connected",e)}notifyConnected(){this.emit("connected")}addDisconnectListener(e){this.addListener("disconnected",e)}removeDisconnectListener(e){this.removeListener("disconnected",e)}notifyDisconnected(){this.emit("disconnected")}}var K=(t=>(t.REQUEST="request",t.RESPONSE="response",t))(K||{});function Vs(t){const e=typeof t=="string"?t:t.id;if(!e)throw new Error("Request Id must be set");return e}const Ds="";class Hs extends Xe{constructor(e){super(),this.transport=e,this.transport=e}get transportName(){return"sync"}get isConnected(){return this.transport.isConnected&&this.connected}async pureConnect(){await this.transport.connect(),this.transport.addConnectListener(this.handleReconnected),this.transport.pipe(this)}pureDisconnect(){this.transport.disconnect(),this.transport.removeConnectListener(this.handleReconnected),this.transport.unpipe(this)}sendVolativeRequest(e){this.sendRawMessage({type:K.REQUEST,id:Ds,data:e})}sendRawMessage(e){this.transport.sendMessage(e)}attachListeners(){this.transport.addMessageListener(this.handleRawMessage),this.transport.addDisconnectListener(this.handleDisconnected)}detachListeners(){this.transport.removeMessageListener(this.handleRawMessage),this.transport.removeDisconnectListener(this.handleDisconnected)}handleRawMessage(e){const r=e.message;this.dispatchMessage(r),r.type===K.REQUEST?this.emitEvent({type:"request",data:r}):r.type===K.RESPONSE&&(this.emitEvent({type:"response",data:r}),this.#t(r))}#e={};#t(e){if(e.type!==K.RESPONSE)return;const r=e.id,n=this.#e[r];if(!n)return;const{resolve:s,reject:i}=n;if(delete this.#e[r],e.error){i(e.error);return}s(e.data)}sendRequest(e){return new Promise((r,n)=>{const s=Ce();this.#e[s]={resolve:r,reject:n};try{const i=this.sendMessage({id:s,type:K.REQUEST,data:e});Xn(i).catch(o=>{delete this.#e[s],n(o)})}catch(i){delete this.#e[s],n(i)}})}sendError(e,r){this.sendResponse(e,void 0,r)}sendResponse(e,r,n){const s=Vs(e);this.sendMessage({type:K.RESPONSE,id:s,data:r,error:U(n)})}addRequestListener(e){this.addListener("request",e)}removeRequestListener(e){this.removeListener("request",e)}addResponseListener(e){this.addListener("response",e)}removeResponseListener(e){this.removeListener("response",e)}}class Bs{constructor(e={}){this.options=e}transports=[];run(){this.transports.forEach(e=>{const r=async()=>{if(e.isConnected)return;const n=()=>{this.options.autoRetry&&setTimeout(r,this.options.retryInterval||1e3)};return await e.connect().then(()=>{e.once("disconnected",()=>{n()})}).catch(()=>{n()})};r()})}addTransport(e){this.transports.push(e)}removeTransport(e){this.transports.splice(this.transports.indexOf(e),1)}}var G=(t=>(t.REQUEST="rpc_request",t.CALLBACK_REQUEST="rpc_callback_request",t.REMOVE_CALLBACK_REQUEST="rpc_remove_callback_request",t))(G||{});function Qt(t){return t.transportName==="sync"}function ne(t){return Qt(t)?t:new Hs(t)}var Ke=(t=>(t.CLIENT="client",t.SERVER="server",t))(Ke||{});const H={ID:Symbol.for("id"),CLIENT_LISTENER:Symbol.for("client_listener"),TRANSPORT:Symbol.for("transport"),RPC_TRANSPORT:Symbol.for("rpc_transport"),RPC_LINKS:Symbol.for("rpc_links")};function Xt(t){return t&&typeof t=="object"&&!Array.isArray(t)}function Kt(t){return Xt(t)?t:void 0}class Us{callbackIdMap=new Map;realCallbackMap=new Map;boundCallbackMap=new Map;fakeCallbackMap=new Map;constructor(){}storeRealCallback(e,r,n){let s=this.callbackIdMap.get(r);s||(s=new Map);const i=Kt(n);s.set(i,e),this.callbackIdMap.set(r,s),this.realCallbackMap.set(e,r);const o=Xt(n)?r.bind(n):r;this.boundCallbackMap.set(e,o)}removeRealCallback(e){e&&(this.realCallbackMap.delete(e),this.boundCallbackMap.delete(e));const r=this.findRealCallback(e);r&&this.callbackIdMap.delete(r)}storeFakeCallback(e,r,n){this.fakeCallbackMap.set(e,new WeakRef(r)),Jn(r,()=>{this.removeFakeCallback(e),n()})}removeFakeCallback(e){this.fakeCallbackMap.delete(e)}findRealCallbackId(e,r){return this.callbackIdMap.get(e)?.get(Kt(r))}findRealCallback(e){return this.realCallbackMap.get(e)}findBoundCallback(e){return this.boundCallbackMap.get(e)}findFakeCallback(e){return this.fakeCallbackMap.get(e)?.deref()}}class Jt{constructor(e){this.proxyObject=e,this.id||this.set(H.ID,ws())}get links(){return this.get(H.RPC_LINKS,[])}get transport(){return this.get(H.TRANSPORT,{})}get clientListener(){return this.get(H.CLIENT_LISTENER)}get rpcTransport(){return this.get(H.RPC_TRANSPORT,{})}get id(){return this.get(H.ID)}get(e,r){const n=this.proxyObject[e];return n===void 0?r:n}set(e,r){this.proxyObject[e]=r}setTransport(e){return this.set(H.TRANSPORT,e),this}setRPCTransport(e){return this.set(H.RPC_TRANSPORT,e),this}setClientListener(e){return this.set(H.CLIENT_LISTENER,e),this}getLinks(e){return this.links.filter(r=>!(e?.channel&&r.channel!==e.channel||e?.rpcTransport&&(Qt(e?.rpcTransport)?r.rpcTransport!==e.rpcTransport:r.rpcTransport.transport!==e.rpcTransport)))}getClientLinks(e){return this.getLinks({...e,type:Ke.CLIENT})}getServerLinks(e){return this.getLinks({...e,type:Ke.SERVER})}}const se=new Us;async function js(t,...e){const{property:r,syncTransport:n,channel:s}=t;if(n.isConnected||await n.connect(),typeof r!="string")return;const i=P.wrapArgs(e),o=Ce(),c=await n.sendRequest({type:G.REQUEST,id:o,method:r,args:i,channel:s,objectInfo:t.objectInfo}).finally(()=>{});return P.unwrapArgs(c,n,s)}function Zt(t){let e;const r=t.property==="object"?{}:()=>{},n=new Proxy(r,{has(s,i){return i!=="then"},getPrototypeOf(){return Object.prototype},apply(s,i,o){return!t.property||t.property==="object"?e.deref():js(t,...o)},get(s,i){if(i!=="then"){if(i===H.TRANSPORT)return t.syncTransport;if(typeof i=="symbol"||Hn(t.object,[String(t.property),i])){const o=Be(t.object,[String(t.property),i]);if(Ns(o)||typeof i=="symbol")return o}return Zt({...t,property:`${String(t.property)}.${i}`})}}});return e=new WeakRef(n),n}class P{static wrapArgs(e,r){if(e!==void 0)return JSON.parse(JSON.stringify(e,function(n,s){if(typeof s!="function")return s;const i=s,o=se.findRealCallbackId(i,this);if(o)return o;const c=r?`$SyncFunction:${Ce()}`:`$Function:${Ce()}`;return se.storeRealCallback(c,i,this),c}))}static unwrapArgs(e,r,n,s){const i=s?.method,o=typeof i=="string"&&i.endsWith("addListener"),c=(g,E)=>{if(typeof E!="string"||!E.startsWith("$Function:")&&!E.startsWith("$SyncFunction:"))return E;const R=E,C=se.findFakeCallback(R);if(C)return C;const fe=o||E.startsWith("$SyncFunction:")?(...oe)=>{const ge=g?.endsWith("addListener");return r.sendRequest({type:G.CALLBACK_REQUEST,callbackId:R,args:P.wrapArgs(oe,ge),channel:n}),!0}:async(...oe)=>{const ge=g?.endsWith("addListener");return await r.sendRequest({type:G.CALLBACK_REQUEST,callbackId:R,args:P.wrapArgs(oe,ge),channel:n})};return Object.defineProperty(fe,"name",{value:R}),se.storeFakeCallback(R,fe,()=>{r.isConnected&&r.sendVolativeRequest({type:G.REMOVE_CALLBACK_REQUEST,callbackId:R,channel:n})}),fe};return e===void 0?void 0:JSON.parse(JSON.stringify(e),c)}static handleCallbackRequest=async(e,r)=>{const n=e.data;if(!n)return;const s=n.data;if(s.type===G.CALLBACK_REQUEST){const i=se.findBoundCallback(s.callbackId);if(i)try{const o=P.unwrapArgs(s.args,r,s.channel),c=await i(...o);r.sendResponse(n,c)}catch(o){r.sendError(n,U(o))}else console.warn("Callback not found:",s.callbackId);return}if(s.type===G.REMOVE_CALLBACK_REQUEST){se.removeRealCallback(s.callbackId);return}};static attachToClient(e,r,n,s){const i=ne(r),o=Zt({object:{object:e},property:"object",syncTransport:i,channel:n,objectInfo:s}),c=l=>{l?.data?.data?.channel===n&&this.handleCallbackRequest(l,i)};return i.addRequestListener(c),new Jt(o).setTransport(r).setRPCTransport(i).setClientListener(c),o}static detachFromClient(e){const r=new Jt(e),n=r.rpcTransport,s=r.clientListener;n?.removeRequestListener?.(s)}static attachToServer(e,r,n){const s=ne(r);s.connect();const i=async o=>{const c=o.data;if(!c)return;const l=c.data;if(l.channel===n&&(this.handleCallbackRequest(o,s),l.type===G.REQUEST))try{const g=typeof e=="function"?await e(l.objectInfo):e;if(!g){s.sendResponse(c,void 0,new Error(`Object not found: "${te(l.objectInfo)}"`));return}const E={object:g};if(!Be(E,l.method)){s.sendResponse(c,void 0,new Error(`Method not found: "${String(l.method)}"`));return}const R=P.unwrapArgs(l.args,s,n,l),C=await this.call(E,l,R);if(!c.id)return;const I=P.wrapArgs(C);s.sendResponse(c,I)}catch(g){s.sendError(c,U(g))}};return s.addRequestListener(i),()=>{s.removeRequestListener(i)}}static call(e,r,n){return Pt(e,r.method,n)}static linkChannels(e,r,n){this.fowardChannels(e,r,n),this.fowardChannels(r,e,n)}static fowardChannels(e,r,n){const s=ne(e),i=ne(r);s.addRequestListener(async o=>{const c=o.data;if(!c)return;const l=c.data;if(!(l.channel!==n||l.type!==G.REQUEST))try{const g=await i.sendRequest(c.data);s.sendResponse(c,g)}catch(g){s.sendError(c,U(g))}})}}class er extends Xe{port;extensionId;name;paused=!1;get isConnected(){return!!this.port&&this.connected}constructor(e,r=chrome.runtime.id){super(),this.name=e,typeof r=="string"&&(this.extensionId=r),typeof r=="object"&&(this.port=r,this.name=this.port.name),this.handlePageShow=this.handlePageShow.bind(this),this.handlePageHide=this.handlePageHide.bind(this),this.trackNavigation()}trackNavigation(){globalThis.top&&(globalThis.addEventListener("pageshow",this.handlePageShow,!0),globalThis.addEventListener("pagehide",this.handlePageHide,!0))}untrackNavigation(){globalThis.top&&(globalThis.removeEventListener("pageshow",this.handlePageShow,!0),globalThis.removeEventListener("pagehide",this.handlePageHide,!0))}async handlePageShow(){this.connected&&this.paused&&(this.paused=!1,await this.disconnect(),await this.handleDisconnected(),await this.connect(),this.emit("reconnected"))}async handlePageHide(){this.paused=!0}async pureConnect(){if(!chrome.runtime)throw new Error("Chrome.runtime is undefined in this context");if(this.extensionId)try{await chrome.runtime.sendMessage(this.extensionId,"ping"),this.port=chrome.runtime.connect(this.extensionId,{name:this.name})}catch(e){throw e}if(!this.port)throw new Error("Unable to establish a connection")}attachListeners(){this.port?.onDisconnect.addListener(this.handleDisconnected),this.port?.onMessage.addListener(this.handleRawMessage)}detachListeners(){this.port?.onDisconnect.addListener(this.handleDisconnected),this.port?.onMessage.removeListener(this.handleRawMessage)}pureDisconnect(...e){try{this.port?.disconnect()}catch{}}handleDisconnected(){super.handleDisconnected(),this.port=void 0}sendRawMessage(e){this.port.postMessage(e)}}class Gs extends Fs{listen(){chrome.runtime.onMessage.addListener((e,r,n)=>{e==="ping"&&n("pong")}),chrome.runtime.onMessageExternal.addListener((e,r,n)=>{e==="ping"&&n("pong")}),chrome.runtime.onConnect.addListener(async e=>{console.log("> New connection:",e);const r=ne(new er(e.name,e));await r.connect(),this.notifyConnection(r)}),chrome.runtime.onConnectExternal.addListener(async e=>{console.log("> New external connection",e);const r=ne(new er(e.name,e));await r.connect(),this.notifyConnection(r)})}}const Je=globalThis.WebSocket;class Ys extends Xe{constructor(e){super(),this.options=e}socket;get server(){return this.options.server}set server(e){this.options.server=e}get isConnected(){return this.socket?.readyState===Je.OPEN}async pureConnect(){await new Promise((e,r)=>{let n=0,s,i;const o=()=>{clearTimeout(n),this.socket&&(i&&this.socket?.removeEventListener("error",i),s&&this.socket?.removeEventListener("open",s))};try{this.socket=new Je(this.server);let c=!1;s=()=>{o(),!c&&(c=!0,e())},this.socket.addEventListener("open",s),i=l=>{if(o(),c)return;c=!0;const g=`Cannot connect to this server: ${this.options.server} (${l.data})`;r(Te(g)),this.pureDisconnect()},this.socket.addEventListener("error",i),this.options.timeout&&(n=setTimeout(()=>{(!this.socket||this.socket.readyState!==Je.OPEN)&&(o(),r(Te(`Cannot connect to this server: ${this.options.server} (timeout)`)),this.pureDisconnect())},this.options.timeout))}catch(c){o(),r(new Error(`Cannot connect to this server: ${this.options.server} (${U(c).message})`)),this.pureDisconnect()}}),this.socket?.addEventListener("open",this.handleReconnected)}pureDisconnect(){this.socket?.close(),this.socket?.removeEventListener("open",this.handleReconnected)}attachListeners(){this.socket?.addEventListener("message",this.handleRawMessage),this.socket?.addEventListener("close",this.handleDisconnected)}detachListeners(){this.socket?.removeEventListener("message",this.handleRawMessage),this.socket?.removeEventListener("close",this.handleDisconnected)}handleRawMessage(e,r){r?.("ok"),super.handleRawMessage(e)}serializeMessage(e){return JSON.stringify(e)}deserializeMessage(e){return JSON.parse(e.data)}sendRawMessage(e){this.socket?.send(e)}}const qs={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},tr={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},T={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},N={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},Y={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"};class a{static getFirstMatch(e,r){const n=r.match(e);return n&&n.length>0&&n[1]||""}static getSecondMatch(e,r){const n=r.match(e);return n&&n.length>1&&n[2]||""}static matchAndReturnConst(e,r,n){if(e.test(r))return n}static getWindowsVersionName(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}static getMacOSVersionName(e){const r=e.split(".").splice(0,2).map(n=>parseInt(n,10)||0);if(r.push(0),r[0]===10)switch(r[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}}static getAndroidVersionName(e){const r=e.split(".").splice(0,2).map(n=>parseInt(n,10)||0);if(r.push(0),!(r[0]===1&&r[1]<5)){if(r[0]===1&&r[1]<6)return"Cupcake";if(r[0]===1&&r[1]>=6)return"Donut";if(r[0]===2&&r[1]<2)return"Eclair";if(r[0]===2&&r[1]===2)return"Froyo";if(r[0]===2&&r[1]>2)return"Gingerbread";if(r[0]===3)return"Honeycomb";if(r[0]===4&&r[1]<1)return"Ice Cream Sandwich";if(r[0]===4&&r[1]<4)return"Jelly Bean";if(r[0]===4&&r[1]>=4)return"KitKat";if(r[0]===5)return"Lollipop";if(r[0]===6)return"Marshmallow";if(r[0]===7)return"Nougat";if(r[0]===8)return"Oreo";if(r[0]===9)return"Pie"}}static getVersionPrecision(e){return e.split(".").length}static compareVersions(e,r,n=!1){const s=a.getVersionPrecision(e),i=a.getVersionPrecision(r);let o=Math.max(s,i),c=0;const l=a.map([e,r],g=>{const E=o-a.getVersionPrecision(g),R=g+new Array(E+1).join(".0");return a.map(R.split("."),C=>new Array(20-C.length).join("0")+C).reverse()});for(n&&(c=o-Math.min(s,i)),o-=1;o>=c;){if(l[0][o]>l[1][o])return 1;if(l[0][o]===l[1][o]){if(o===c)return 0;o-=1}else if(l[0][o]<l[1][o])return-1}}static map(e,r){const n=[];let s;if(Array.prototype.map)return Array.prototype.map.call(e,r);for(s=0;s<e.length;s+=1)n.push(r(e[s]));return n}static find(e,r){let n,s;if(Array.prototype.find)return Array.prototype.find.call(e,r);for(n=0,s=e.length;n<s;n+=1){const i=e[n];if(r(i,n))return i}}static assign(e,...r){const n=e;let s,i;if(Object.assign)return Object.assign(e,...r);for(s=0,i=r.length;s<i;s+=1){const o=r[s];typeof o=="object"&&o!==null&&Object.keys(o).forEach(l=>{n[l]=o[l]})}return e}static getBrowserAlias(e){return qs[e]}static getBrowserTypeByAlias(e){return tr[e]||""}}const v=/version\/(\d+(\.?_?\d+)+)/i,$s=[{test:[/googlebot/i],describe(t){const e={name:"Googlebot"},r=a.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,t)||a.getFirstMatch(v,t);return r&&(e.version=r),e}},{test:[/opera/i],describe(t){const e={name:"Opera"},r=a.getFirstMatch(v,t)||a.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/opr\/|opios/i],describe(t){const e={name:"Opera"},r=a.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,t)||a.getFirstMatch(v,t);return r&&(e.version=r),e}},{test:[/SamsungBrowser/i],describe(t){const e={name:"Samsung Internet for Android"},r=a.getFirstMatch(v,t)||a.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/Whale/i],describe(t){const e={name:"NAVER Whale Browser"},r=a.getFirstMatch(v,t)||a.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/MZBrowser/i],describe(t){const e={name:"MZ Browser"},r=a.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,t)||a.getFirstMatch(v,t);return r&&(e.version=r),e}},{test:[/focus/i],describe(t){const e={name:"Focus"},r=a.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,t)||a.getFirstMatch(v,t);return r&&(e.version=r),e}},{test:[/swing/i],describe(t){const e={name:"Swing"},r=a.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,t)||a.getFirstMatch(v,t);return r&&(e.version=r),e}},{test:[/coast/i],describe(t){const e={name:"Opera Coast"},r=a.getFirstMatch(v,t)||a.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe(t){const e={name:"Opera Touch"},r=a.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,t)||a.getFirstMatch(v,t);return r&&(e.version=r),e}},{test:[/yabrowser/i],describe(t){const e={name:"Yandex Browser"},r=a.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,t)||a.getFirstMatch(v,t);return r&&(e.version=r),e}},{test:[/ucbrowser/i],describe(t){const e={name:"UC Browser"},r=a.getFirstMatch(v,t)||a.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/Maxthon|mxios/i],describe(t){const e={name:"Maxthon"},r=a.getFirstMatch(v,t)||a.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/epiphany/i],describe(t){const e={name:"Epiphany"},r=a.getFirstMatch(v,t)||a.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/puffin/i],describe(t){const e={name:"Puffin"},r=a.getFirstMatch(v,t)||a.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/sleipnir/i],describe(t){const e={name:"Sleipnir"},r=a.getFirstMatch(v,t)||a.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/k-meleon/i],describe(t){const e={name:"K-Meleon"},r=a.getFirstMatch(v,t)||a.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/micromessenger/i],describe(t){const e={name:"WeChat"},r=a.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,t)||a.getFirstMatch(v,t);return r&&(e.version=r),e}},{test:[/qqbrowser/i],describe(t){const e={name:/qqbrowserlite/i.test(t)?"QQ Browser Lite":"QQ Browser"},r=a.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,t)||a.getFirstMatch(v,t);return r&&(e.version=r),e}},{test:[/msie|trident/i],describe(t){const e={name:"Internet Explorer"},r=a.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/\sedg\//i],describe(t){const e={name:"Microsoft Edge"},r=a.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/edg([ea]|ios)/i],describe(t){const e={name:"Microsoft Edge"},r=a.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/vivaldi/i],describe(t){const e={name:"Vivaldi"},r=a.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/seamonkey/i],describe(t){const e={name:"SeaMonkey"},r=a.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/sailfish/i],describe(t){const e={name:"Sailfish"},r=a.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,t);return r&&(e.version=r),e}},{test:[/silk/i],describe(t){const e={name:"Amazon Silk"},r=a.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/phantom/i],describe(t){const e={name:"PhantomJS"},r=a.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/slimerjs/i],describe(t){const e={name:"SlimerJS"},r=a.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(t){const e={name:"BlackBerry"},r=a.getFirstMatch(v,t)||a.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/(web|hpw)[o0]s/i],describe(t){const e={name:"WebOS Browser"},r=a.getFirstMatch(v,t)||a.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/bada/i],describe(t){const e={name:"Bada"},r=a.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/tizen/i],describe(t){const e={name:"Tizen"},r=a.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,t)||a.getFirstMatch(v,t);return r&&(e.version=r),e}},{test:[/qupzilla/i],describe(t){const e={name:"QupZilla"},r=a.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,t)||a.getFirstMatch(v,t);return r&&(e.version=r),e}},{test:[/firefox|iceweasel|fxios/i],describe(t){const e={name:"Firefox"},r=a.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/electron/i],describe(t){const e={name:"Electron"},r=a.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/MiuiBrowser/i],describe(t){const e={name:"Miui"},r=a.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/chromium/i],describe(t){const e={name:"Chromium"},r=a.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,t)||a.getFirstMatch(v,t);return r&&(e.version=r),e}},{test:[/chrome|crios|crmo/i],describe(t){const e={name:"Chrome"},r=a.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/GSA/i],describe(t){const e={name:"Google Search"},r=a.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test(t){const e=!t.test(/like android/i),r=t.test(/android/i);return e&&r},describe(t){const e={name:"Android Browser"},r=a.getFirstMatch(v,t);return r&&(e.version=r),e}},{test:[/playstation 4/i],describe(t){const e={name:"PlayStation 4"},r=a.getFirstMatch(v,t);return r&&(e.version=r),e}},{test:[/safari|applewebkit/i],describe(t){const e={name:"Safari"},r=a.getFirstMatch(v,t);return r&&(e.version=r),e}},{test:[/.*/i],describe(t){const e=/^(.*)\/(.*) /,r=/^(.*)\/(.*)[ \t]\((.*)/,s=t.search("\\(")!==-1?r:e;return{name:a.getFirstMatch(s,t),version:a.getSecondMatch(s,t)}}}],Ws=[{test:[/Roku\/DVP/],describe(t){const e=a.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,t);return{name:N.Roku,version:e}}},{test:[/windows phone/i],describe(t){const e=a.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,t);return{name:N.WindowsPhone,version:e}}},{test:[/windows /i],describe(t){const e=a.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,t),r=a.getWindowsVersionName(e);return{name:N.Windows,version:e,versionName:r}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe(t){const e={name:N.iOS},r=a.getSecondMatch(/(Version\/)(\d[\d.]+)/,t);return r&&(e.version=r),e}},{test:[/macintosh/i],describe(t){const e=a.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,t).replace(/[_\s]/g,"."),r=a.getMacOSVersionName(e),n={name:N.MacOS,version:e};return r&&(n.versionName=r),n}},{test:[/(ipod|iphone|ipad)/i],describe(t){const e=a.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,t).replace(/[_\s]/g,".");return{name:N.iOS,version:e}}},{test(t){const e=!t.test(/like android/i),r=t.test(/android/i);return e&&r},describe(t){const e=a.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,t),r=a.getAndroidVersionName(e),n={name:N.Android,version:e};return r&&(n.versionName=r),n}},{test:[/(web|hpw)[o0]s/i],describe(t){const e=a.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,t),r={name:N.WebOS};return e&&e.length&&(r.version=e),r}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(t){const e=a.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,t)||a.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,t)||a.getFirstMatch(/\bbb(\d+)/i,t);return{name:N.BlackBerry,version:e}}},{test:[/bada/i],describe(t){const e=a.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,t);return{name:N.Bada,version:e}}},{test:[/tizen/i],describe(t){const e=a.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,t);return{name:N.Tizen,version:e}}},{test:[/linux/i],describe(){return{name:N.Linux}}},{test:[/CrOS/],describe(){return{name:N.ChromeOS}}},{test:[/PlayStation 4/],describe(t){const e=a.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,t);return{name:N.PlayStation4,version:e}}}],zs=[{test:[/googlebot/i],describe(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe(t){const e=a.getFirstMatch(/(can-l01)/i,t)&&"Nova",r={type:T.mobile,vendor:"Huawei"};return e&&(r.model=e),r}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe(){return{type:T.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe(){return{type:T.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe(){return{type:T.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe(){return{type:T.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe(){return{type:T.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe(){return{type:T.tablet}}},{test(t){const e=t.test(/ipod|iphone/i),r=t.test(/like (ipod|iphone)/i);return e&&!r},describe(t){const e=a.getFirstMatch(/(ipod|iphone)/i,t);return{type:T.mobile,vendor:"Apple",model:e}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe(){return{type:T.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe(){return{type:T.mobile}}},{test(t){return t.getBrowserName(!0)==="blackberry"},describe(){return{type:T.mobile,vendor:"BlackBerry"}}},{test(t){return t.getBrowserName(!0)==="bada"},describe(){return{type:T.mobile}}},{test(t){return t.getBrowserName()==="windows phone"},describe(){return{type:T.mobile,vendor:"Microsoft"}}},{test(t){const e=Number(String(t.getOSVersion()).split(".")[0]);return t.getOSName(!0)==="android"&&e>=3},describe(){return{type:T.tablet}}},{test(t){return t.getOSName(!0)==="android"},describe(){return{type:T.mobile}}},{test(t){return t.getOSName(!0)==="macos"},describe(){return{type:T.desktop,vendor:"Apple"}}},{test(t){return t.getOSName(!0)==="windows"},describe(){return{type:T.desktop}}},{test(t){return t.getOSName(!0)==="linux"},describe(){return{type:T.desktop}}},{test(t){return t.getOSName(!0)==="playstation 4"},describe(){return{type:T.tv}}},{test(t){return t.getOSName(!0)==="roku"},describe(){return{type:T.tv}}}],Qs=[{test(t){return t.getBrowserName(!0)==="microsoft edge"},describe(t){if(/\sedg\//i.test(t))return{name:Y.Blink};const r=a.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,t);return{name:Y.EdgeHTML,version:r}}},{test:[/trident/i],describe(t){const e={name:Y.Trident},r=a.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test(t){return t.test(/presto/i)},describe(t){const e={name:Y.Presto},r=a.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test(t){const e=t.test(/gecko/i),r=t.test(/like gecko/i);return e&&!r},describe(t){const e={name:Y.Gecko},r=a.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/(apple)?webkit\/537\.36/i],describe(){return{name:Y.Blink}}},{test:[/(apple)?webkit/i],describe(t){const e={name:Y.WebKit},r=a.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}}];class rr{constructor(e,r=!1){if(e==null||e==="")throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},r!==!0&&this.parse()}getUA(){return this._ua}test(e){return e.test(this._ua)}parseBrowser(){this.parsedResult.browser={};const e=a.find($s,r=>{if(typeof r.test=="function")return r.test(this);if(r.test instanceof Array)return r.test.some(n=>this.test(n));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.browser=e.describe(this.getUA())),this.parsedResult.browser}getBrowser(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()}getBrowserName(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""}getBrowserVersion(){return this.getBrowser().version}getOS(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()}parseOS(){this.parsedResult.os={};const e=a.find(Ws,r=>{if(typeof r.test=="function")return r.test(this);if(r.test instanceof Array)return r.test.some(n=>this.test(n));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.os=e.describe(this.getUA())),this.parsedResult.os}getOSName(e){const{name:r}=this.getOS();return e?String(r).toLowerCase()||"":r||""}getOSVersion(){return this.getOS().version}getPlatform(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()}getPlatformType(e=!1){const{type:r}=this.getPlatform();return e?String(r).toLowerCase()||"":r||""}parsePlatform(){this.parsedResult.platform={};const e=a.find(zs,r=>{if(typeof r.test=="function")return r.test(this);if(r.test instanceof Array)return r.test.some(n=>this.test(n));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.platform=e.describe(this.getUA())),this.parsedResult.platform}getEngine(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()}getEngineName(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""}parseEngine(){this.parsedResult.engine={};const e=a.find(Qs,r=>{if(typeof r.test=="function")return r.test(this);if(r.test instanceof Array)return r.test.some(n=>this.test(n));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.engine=e.describe(this.getUA())),this.parsedResult.engine}parse(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this}getResult(){return a.assign({},this.parsedResult)}satisfies(e){const r={};let n=0;const s={};let i=0;if(Object.keys(e).forEach(c=>{const l=e[c];typeof l=="string"?(s[c]=l,i+=1):typeof l=="object"&&(r[c]=l,n+=1)}),n>0){const c=Object.keys(r),l=a.find(c,E=>this.isOS(E));if(l){const E=this.satisfies(r[l]);if(E!==void 0)return E}const g=a.find(c,E=>this.isPlatform(E));if(g){const E=this.satisfies(r[g]);if(E!==void 0)return E}}if(i>0){const c=Object.keys(s),l=a.find(c,g=>this.isBrowser(g,!0));if(l!==void 0)return this.compareVersion(s[l])}}isBrowser(e,r=!1){const n=this.getBrowserName().toLowerCase();let s=e.toLowerCase();const i=a.getBrowserTypeByAlias(s);return r&&i&&(s=i.toLowerCase()),s===n}compareVersion(e){let r=[0],n=e,s=!1;const i=this.getBrowserVersion();if(typeof i=="string")return e[0]===">"||e[0]==="<"?(n=e.substr(1),e[1]==="="?(s=!0,n=e.substr(2)):r=[],e[0]===">"?r.push(1):r.push(-1)):e[0]==="="?n=e.substr(1):e[0]==="~"&&(s=!0,n=e.substr(1)),r.indexOf(a.compareVersions(i,n,s))>-1}isOS(e){return this.getOSName(!0)===String(e).toLowerCase()}isPlatform(e){return this.getPlatformType(!0)===String(e).toLowerCase()}isEngine(e){return this.getEngineName(!0)===String(e).toLowerCase()}is(e,r=!1){return this.isBrowser(e,r)||this.isOS(e)||this.isPlatform(e)}some(e=[]){return e.some(r=>this.is(r))}}/*!
 * Bowser - a browser detector
 * https://github.com/lancedikson/bowser
 * MIT License | (c) Dustin Diaz 2012-2015
 * MIT License | (c) Denis Demchenko 2015-2019
 */class Xs{static getParser(e,r=!1){if(typeof e!="string")throw new Error("UserAgent should be a string");return new rr(e,r)}static parse(e){return new rr(e).getResult()}static get BROWSER_MAP(){return tr}static get ENGINE_MAP(){return Y}static get OS_MAP(){return N}static get PLATFORMS_MAP(){return T}}const Ze=Xs.getParser(globalThis.navigator.userAgent);var nr={exports:{}};(function(t,e){(function(r,n){n(t)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:Un,function(r){if(!(globalThis.chrome&&globalThis.chrome.runtime&&globalThis.chrome.runtime.id))throw new Error("This script should only be loaded in a browser extension.");if(globalThis.browser&&globalThis.browser.runtime&&globalThis.browser.runtime.id)r.exports=globalThis.browser;else{const n="The message port closed before a response was received.",s=i=>{const o={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(o).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class c extends WeakMap{constructor(u,m=void 0){super(m),this.createItem=u}get(u){return this.has(u)||this.set(u,this.createItem(u)),super.get(u)}}const l=d=>d&&typeof d=="object"&&typeof d.then=="function",g=(d,u)=>(...m)=>{i.runtime.lastError?d.reject(new Error(i.runtime.lastError.message)):u.singleCallbackArg||m.length<=1&&u.singleCallbackArg!==!1?d.resolve(m[0]):d.resolve(m)},E=d=>d==1?"argument":"arguments",R=(d,u)=>function(A,...S){if(S.length<u.minArgs)throw new Error(`Expected at least ${u.minArgs} ${E(u.minArgs)} for ${d}(), got ${S.length}`);if(S.length>u.maxArgs)throw new Error(`Expected at most ${u.maxArgs} ${E(u.maxArgs)} for ${d}(), got ${S.length}`);return new Promise((x,k)=>{if(u.fallbackToNoCallback)try{A[d](...S,g({resolve:x,reject:k},u))}catch(f){console.warn(`${d} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,f),A[d](...S),u.fallbackToNoCallback=!1,u.noCallback=!0,x()}else u.noCallback?(A[d](...S),x()):A[d](...S,g({resolve:x,reject:k},u))})},C=(d,u,m)=>new Proxy(u,{apply(A,S,x){return m.call(S,d,...x)}});let I=Function.call.bind(Object.prototype.hasOwnProperty);const he=(d,u={},m={})=>{let A=Object.create(null),S={has(k,f){return f in d||f in A},get(k,f,F){if(f in A)return A[f];if(!(f in d))return;let y=d[f];if(typeof y=="function")if(typeof u[f]=="function")y=C(d,d[f],u[f]);else if(I(m,f)){let ae=R(f,m[f]);y=C(d,d[f],ae)}else y=y.bind(d);else if(typeof y=="object"&&y!==null&&(I(u,f)||I(m,f)))y=he(y,u[f],m[f]);else if(I(m,"*"))y=he(y,u[f],m["*"]);else return Object.defineProperty(A,f,{configurable:!0,enumerable:!0,get(){return d[f]},set(ae){d[f]=ae}}),y;return A[f]=y,y},set(k,f,F,y){return f in A?A[f]=F:d[f]=F,!0},defineProperty(k,f,F){return Reflect.defineProperty(A,f,F)},deleteProperty(k,f){return Reflect.deleteProperty(A,f)}},x=Object.create(d);return new Proxy(x,S)},Oe=d=>({addListener(u,m,...A){u.addListener(d.get(m),...A)},hasListener(u,m){return u.hasListener(d.get(m))},removeListener(u,m){u.removeListener(d.get(m))}}),fe=new c(d=>typeof d!="function"?d:function(m){const A=he(m,{},{getContent:{minArgs:0,maxArgs:0}});d(A)}),oe=new c(d=>typeof d!="function"?d:function(m,A,S){let x=!1,k,f=new Promise(me=>{k=function(B){x=!0,me(B)}}),F;try{F=d(m,A,k)}catch(me){F=Promise.reject(me)}const y=F!==!0&&l(F);if(F!==!0&&!y&&!x)return!1;const ae=me=>{me.then(B=>{S(B)},B=>{let ct;B&&(B instanceof Error||typeof B.message=="string")?ct=B.message:ct="An unexpected error occurred",S({__mozWebExtensionPolyfillReject__:!0,message:ct})}).catch(B=>{console.error("Failed to send onMessage rejected reply",B)})};return ae(y?F:f),!0}),ge=({reject:d,resolve:u},m)=>{i.runtime.lastError?i.runtime.lastError.message===n?u():d(new Error(i.runtime.lastError.message)):m&&m.__mozWebExtensionPolyfillReject__?d(new Error(m.message)):u(m)},ot=(d,u,m,...A)=>{if(A.length<u.minArgs)throw new Error(`Expected at least ${u.minArgs} ${E(u.minArgs)} for ${d}(), got ${A.length}`);if(A.length>u.maxArgs)throw new Error(`Expected at most ${u.maxArgs} ${E(u.maxArgs)} for ${d}(), got ${A.length}`);return new Promise((S,x)=>{const k=ge.bind(null,{resolve:S,reject:x});A.push(k),m.sendMessage(...A)})},Bi={devtools:{network:{onRequestFinished:Oe(fe)}},runtime:{onMessage:Oe(oe),onMessageExternal:Oe(oe),sendMessage:ot.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:ot.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},at={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return o.privacy={network:{"*":at},services:{"*":at},websites:{"*":at}},he(i,Bi,o)};r.exports=s(chrome)}})})(nr);var Ks=nr.exports;const _=jn(Ks),sr=["all"];function et(t,e){return t.map(r=>{if(typeof r=="string")return{id:r,type:"separator",contexts:sr,parentId:e};const n=r.id||r.label,s=r.label||r.id;return[{id:n,title:s,contexts:sr,...e&&{parentId:e}},...r.children?et(r.children,n):[]]}).flat()}class ir{constructor(e=[],r){this.items=e,this.onAction=r}async register(){await this.unregister(),await this.#e(this.items),_.contextMenus.onClicked.addListener(this.onAction)}async unregister(){_.contextMenus.onClicked.removeListener(this.onAction),await this.#r(this.items)}static async unregisterAll(){await _.contextMenus.removeAll()}async#e(e){await Promise.allSettled(e.map(async r=>{await this.#t(r)}))}async#t(e){return new Promise((r,n)=>{try{_.contextMenus.create({...e},()=>{const s=_.runtime.lastError;s?(console.warn("Failed to create context menu item",e,s),n(s)):r()})}catch(s){console.warn("Failed to create context menu item",e,s),n(s)}})}async#r(e){await Promise.allSettled(e.map(r=>this.#n(r)))}async#n(e){return _.contextMenus.remove(e.id)}}const Me={DEFAULT:{color:"#fff",background:"#aaa"},RECORDING:{color:"#fff",background:"#ff6565"},SPYING:{color:"#fff",background:"#19D89F"},PAUSING:{color:"#fff",background:"#f0b62e"}};function Le(t){t.color&&_.action.setBadgeTextColor({color:t.color}),t.background&&_.action.setBadgeBackgroundColor({color:t.background})}function tt(t){_.action.setBadgeText({text:t?String(t):""})}class Js{totalActions=0;count(e){this.totalActions+=e,tt(this.totalActions)}reset(){this.totalActions=0,tt(" 🚀")}startRecording(){Le(Me.RECORDING),this.reset()}startSpying(){Le(Me.SPYING),this.reset()}pause(){Le(Me.PAUSING)}stop(){Le(Me.DEFAULT),tt()}}const ie=new Js;function Zs(){const t=()=>setInterval(_.runtime.getPlatformInfo,2e4);_.runtime.onStartup.addListener(t),t()}const ue={PageRecorderTransportName:"PageRecorderTransportName",PageRecorderChannel:"PageRecorderChannel",PopupTransportName:"PopupTransportName",SettingsServiceChannel:"SettingsServiceChannel"},ei=5e4;var rt=(t=>(t.FULL="Full",t.SIMPLE="Simple",t.HYBRID="Hybrid",t))(rt||{});class nt{static extensionElementId="katalon-recorder-hud";static aiEnabled=!1;static extensionMode="Hybrid";static get ksPort(){return this.get("katalonServerPort")||ei}static get(e){return globalThis[e]}}class ti extends z{async subscribe(e,r){const n=await this.get(e);n!==void 0&&await r(n),this.on("change",async({key:s,value:i})=>{s===e&&await r(i)})}}const ri=()=>{ir.unregisterAll()},ni=({params:t})=>{const{recorderController:e}=t;e.on("start-recording",()=>{ie.startRecording()}),e.on("start-spying",()=>{ie.startSpying()}),e.on("stop",()=>{ie.stop()}),e.on("paused",()=>{ie.pause()}),e.on("actions-recorded",r=>{ie.count(r.actions.length)}),e.on("test-object-recorded",()=>{ie.count(1)})},si=({params:t})=>{const{recorderController:e}=t;_.action.onClicked.addListener(function(){e.isRecording()||(e.isSpying()?e.stop():e.startSpying())})};var p=(t=>(t.OPEN_BROWSER="openBrowser",t.CLOSE_BROWSER="closeBrowser",t.CLICK="click",t.SET_TEXT="setText",t.SET_ENCRYPTED_TEXT="setEncryptedText",t.DOUBLE_CLICK="doubleClick",t.RIGHT_CLICK="rightClick",t.SEND_KEYS="sendKeys",t.DRAG_AND_DROP="dragAndDropByOffset",t.SELECT_OPTION_BY_VALUE="selectOptionByValue",t.VERIFY_ELEMENT_VISIBLE="verifyElementVisible",t.VERIFY_ELEMENT_NOT_VISIBLE="verifyElementNotVisible",t.SCROLL_TO_ELEMENT="scrollToElement",t.VERIFY_ELEMENT_TEXT="verifyElementText",t.CHECK="check",t.UNCHECK="uncheck",t.GET_URL="getURL",t.GET_TEXT="getText",t.VERIFY_ELEMENT_PRESENT="verifyElementPresent",t.VERIFY_ELEMENT_NOT_PRESENT="verifyElementNotPresent",t.VERIFY_ELEMENT_ATTRIBUTE_VALUE="verifyElementAttributeValue",t.TAKE_SCREENSHOT="takeScreenshot",t.WAIT_FOR_ELEMENT_PRESENT="waitForElementPresent",t.HOVER_OVER="hoverOver",t.VERIFY_URL="verifyURL",t.VERIFY_NUMBER_GREATER_THAN="verifyNumberGreaterThan",t.VERIFY_NUMBER_LESS_THAN="verifyNumberLessThan",t.VERIFY_NUMBER_GREATER_THAN_OR_EQUAL="verifyNumberGreaterThanOrEqual",t.VERIFY_NUMBER_LESS_THAN_OR_EQUAL="verifyNumberLessThanOrEqual",t.VERIFY_ELEMENT_CHECKED="verifyElementChecked",t.INPUT_ACTION="input",t.SUBMIT_ACTION="submit",t.HOVER_ACTION="hover",t.SELECT_ACTION="select",t.SELECT_BY_VALUE_ACTION="select_by_value",t.SELECT_BY_INDEX_ACTION="select_by_index",t.REFRESH_ACTION="refresh",t.NAVIGATE_ACTION="navigate",t.WAIT_ACTION="wait",t.VIEW_ACTION="view",t.LOGIN_ACTION="login",t.BASIC_AUTH="basic-auth",t))(p||{}),or=(t=>(t.CLICK="click",t.HOVER="hover",t.INPUT="input",t))(or||{}),h=(t=>(t.OPEN="open",t.NAVIGATE_TO_URL="navigateToURL",t.CLOSE="close",t.CLICK="click",t.DOUBLE_CLICK="doubleClick",t.RIGHT_CLICK="rightClick",t.SEND_KEYS="sendKeys",t.DRAG_AND_DROP="dragAndDropByOffset",t.SET_TEXT="setText",t.SET_ENCRYPTED_TEXT="setEncryptedText",t.SELECT_OPTION_BY_VALUE="selectOptionByValue",t.SELECT_OPTIONS_BY_VALUE="selectOptionsByValue",t.VERIFY_ELEMENT_VISIBLE="verifyElementVisible",t.VERIFY_ELEMENT_NOT_VISIBLE="verifyElementNotVisible",t.VERIFY_ELEMENT_TEXT="verifyElementText",t.VERIFY_ELEMENT_CLICKABLE="verifyElementClickable",t.VERIFY_ELEMENT_NOT_CLICKABLE="verifyElementNotClickable",t.CHECK="check",t.UNCHECK="uncheck",t.SCROLL_TO_ELEMENT="scrollToElement",t.GET_URL="getURL",t.GET_TEXT="getText",t.VERIFY_ELEMENT_PRESENT="verifyElementPresent",t.VERIFY_ELEMENT_NOT_PRESENT="verifyElementNotPresent",t.VERIFY_ELEMENT_ATTRIBUTE_VALUE="verifyElementAttributeValue",t.TAKE_SCREENSHOT="takeScreenshot",t.WAIT_FOR_ELEMENT_PRESENT="waitForElementPresent",t.WAIT_FOR_ELEMENT_NOT_PRESENT="waitForElementNotPresent",t.WAIT_FOR_ELEMENT_VISIBLE="waitForElementVisible",t.WAIT_FOR_ELEMENT_NOT_VISIBLE="waitForElementNotVisible",t.HOVER_OVER="hoverOver",t.VERIFY_URL="verifyURL",t.VERIFY_NUMBER_GREATER_THAN="verifyNumberGreaterThan",t.VERIFY_NUMBER_LESS_THAN="verifyNumberLessThan",t.VERIFY_NUMBER_GREATER_THAN_OR_EQUAL="verifyNumberGreaterThanOrEqual",t.VERIFY_NUMBER_LESS_THAN_OR_EQUAL="verifyNumberLessThanOrEqual",t.VERIFY_ELEMENT_CHECKED="verifyElementChecked",t.HOVER="hover",t.ACCEPT_ALERT="acceptAlert",t.ACCEPT_CONFIRM="acceptConfirm",t.ACCEPT_PROMPT="acceptPrompt",t.DISMISS_CONFIRM="dismissConfirm",t.DISMISS_PROMPT="dismissPrompt",t))(h||{});or.HOVER+"",p.OPEN_BROWSER,p.CLOSE_BROWSER,p.CLICK,p.DOUBLE_CLICK,p.RIGHT_CLICK,p.SEND_KEYS,p.DRAG_AND_DROP,p.SET_TEXT,p.SET_ENCRYPTED_TEXT,p.SELECT_OPTION_BY_VALUE,p.VERIFY_ELEMENT_VISIBLE,p.VERIFY_ELEMENT_ATTRIBUTE_VALUE,p.VERIFY_ELEMENT_TEXT,p.CHECK,p.UNCHECK,p.SCROLL_TO_ELEMENT,p.GET_URL,p.GET_TEXT,p.VERIFY_ELEMENT_PRESENT,p.VERIFY_ELEMENT_NOT_PRESENT,p.TAKE_SCREENSHOT,p.WAIT_FOR_ELEMENT_PRESENT,p.HOVER_OVER,p.VERIFY_URL,p.VERIFY_NUMBER_GREATER_THAN,p.VERIFY_NUMBER_LESS_THAN,p.VERIFY_NUMBER_GREATER_THAN_OR_EQUAL,p.VERIFY_NUMBER_LESS_THAN_OR_EQUAL,p.VERIFY_ELEMENT_CHECKED,p.HOVER_ACTION;var q=(t=>(t.REQUEST_BROWSER_INFO="REQUEST_BROWSER_INFO",t.BROWSER_INFO="BROWSER_INFO",t.RECORDER_SETTING="RECORDER_SETTING",t.START_INSPECT="START_INSPECT",t.START_RECORD="START_RECORD",t.HIGHLIGHT_OBJECT="HIGHLIGHT_OBJECT",t.TAKE_SCREENSHOT_OBJECT="TAKE_SCREENSHOT_OBJECT",t))(q||{});function ii(t){const e=Object.entries(t)[0];return e?`${e?.[0]}-${e?.[1]}`:""}var xe=(t=>(t.XPATH="XPath",t.CSS="CSS",t.SMART="Smart",t.IMAGE="Image",t.ATTRIBUTE="Attribute",t))(xe||{});function st(t,e){return lr(t,e)}const oi={[h.NAVIGATE_TO_URL]:"navigate",[h.HOVER]:"MouseOver",[h.CLICK]:"click",[h.RIGHT_CLICK]:"click",[h.DOUBLE_CLICK]:"doubleClick",[h.SET_TEXT]:"inputChange",[h.SET_ENCRYPTED_TEXT]:"inputChange",[h.SELECT_OPTION_BY_VALUE]:"inputChange",[h.SEND_KEYS]:"sendKeys",[h.VERIFY_ELEMENT_TEXT]:"VerifyElementText",[h.VERIFY_ELEMENT_PRESENT]:"VerifyElementPresent",[h.VERIFY_ELEMENT_NOT_PRESENT]:"VerifyElementNotPresent",[h.VERIFY_ELEMENT_VISIBLE]:"VerifyElementVisible",[h.VERIFY_ELEMENT_NOT_VISIBLE]:"VerifyElementNotVisible",[h.VERIFY_ELEMENT_CLICKABLE]:"VerifyElementClickable",[h.VERIFY_ELEMENT_NOT_CLICKABLE]:"VerifyElementNotClickable",[h.WAIT_FOR_ELEMENT_PRESENT]:"WaitForElementPresent",[h.WAIT_FOR_ELEMENT_NOT_PRESENT]:"WaitForElementNotPresent",[h.WAIT_FOR_ELEMENT_VISIBLE]:"WaitForElementVisible",[h.WAIT_FOR_ELEMENT_NOT_VISIBLE]:"WaitForElementNotVisible"};function ai(t){return oi[t]}function ci(t,e=12345){return{...Pe(t.target),action:di(t,e)}}function li(t){const e=t.parameters;switch(t.command){case h.CLICK:return"left";case h.RIGHT_CLICK:return"right";case h.SET_TEXT:case h.SET_ENCRYPTED_TEXT:case h.SEND_KEYS:return e?.[0];case h.SELECT_OPTION_BY_VALUE:return{oldValue:[],newValue:[e?.[0]||""]};default:return e?.[0]}}function di(t,e){return{actionName:ai(t.command),actionData:li(t),windowId:e}}function Pe(t){if(!t)return Cs;const e=st(t.selectors,xe.CSS),r=st(t.selectors,xe.XPATH),n=st(t.selectors,xe.SMART);return{test_object_name:t.name.split(" - ").slice(1).join(" - ")||t.name,type:t.tag,xpath:r?.value||"",attributes:{...t.attributes,text:t.text,parent:ii(t.hashes)},page:{url:t.pageUrl,title:t.pageTitle},xpaths:{"xpath:attributes":r?.value?[r?.value]:[],css:e?[`css=${e.value}`]:[]},smart_locator:n?.value||"",parent:t.shadowRoot?{...Pe(t.shadowRoot),shadow_root:!0}:t.parentIframe?Pe(t.parentIframe):null,shadow_element:t.shadowRoot?!0:void 0}}var D=(t=>(t.SPY="spy",t.RECORD="record",t.AUTO="auto",t))(D||{});class it extends z{get supportedModes(){return[D.RECORD,D.SPY]}configs;async config(e){this.configs=e}async start(){}async stop(){}}class ui{constructor(e,r,n,s,i){this.windowId=e,this.tabId=r,this.frameId=n,this.recorder=s,this.transport=i}}function hi(t){return["typed","auto_bookmark","reload","generated","keyword","keyword_generated","auto_toplevel"].includes(t)}function fi(t,e){return t==="link"&&e.includes("from_address_bar")}class gi extends it{constructor(){super(),this.handleTabNavigation=this.handleTabNavigation.bind(this)}async start(){this.configs.mode===D.RECORD&&_.webNavigation.onCommitted.addListener(this.handleTabNavigation)}async stop(){_.webNavigation.onCommitted.removeListener(this.handleTabNavigation)}async handleTabNavigation(e){e.frameId===0&&(hi(e.transitionType)||fi(e.transitionType,e.transitionQualifiers))&&this.emitEvent({type:"actions-recorded",actions:[{command:h.NAVIGATE_TO_URL,parameters:[e.url]}],windowId:e.tabId})}}var L=(t=>(t.CaptureObject="Capture Object",t.Separator1="---1",t.MouseOver="Mouse Over",t.Separator2="---2",t.VerifyElementText="Verify Element Text",t.VerifyElementState="Verify Element State",t.VerifyElementPresent="Verify Element Present",t.VerifyElementNotPresent="Verify Element Not Present",t.VerifyElementVisible="Verify Element Visible",t.VerifyElementNotVisible="Verify Element Not Visible",t.VerifyElementClickable="Verify Element Clickable",t.VerifyElementNotClickable="Verify Element Not Clickable",t.WaitForElement="Wait For Element",t.WaitForElementPresent="Wait For Element Present",t.WaitForElementNotPresent="Wait For Element Not Present",t.WaitForElementVisible="Wait For Element Visible",t.WaitForElementNotVisible="Wait For Element Not Visible",t))(L||{});const mi=et([{id:"parent",label:"Katalon Recorder Plus",children:[{id:"Mouse Over"},"---2",{id:"Verify Element Text"},{id:"Verify Element State",children:[{id:"Verify Element Present",label:"Present"},{id:"Verify Element Not Present",label:"Not Present"},{id:"Verify Element Visible",label:"Visible"},{id:"Verify Element Not Visible",label:"Not Visible"},{id:"Verify Element Clickable",label:"Clickable"},{id:"Verify Element Not Clickable",label:"Not Clickable"}]},"---3",{id:"Wait For Element",children:[{id:"Wait For Element Present",label:"Present"},{id:"Wait For Element Not Present",label:"Not Present"},{id:"Wait For Element Visible",label:"Visible"},{id:"Wait For Element Not Visible",label:"Not Visible"}]}]}],void 0);var ar=(t=>(t.CaptureObject="Capture Object",t))(ar||{});const pi=et([{id:"parent",label:"Katalon Recorder Plus",children:[{id:"Capture Object"}]}],void 0);class Ei extends it{contextMenuManager;constructor(){super(),this.handleContextAction=this.handleContextAction.bind(this)}get#e(){return this.configs.mode===D.RECORD}async start(){const e=this.#e?mi:pi;this.contextMenuManager=new ir(e,this.handleContextAction.bind(this)),await this.contextMenuManager.register()}async stop(){await this.contextMenuManager?.unregister()}handleContextAction(e,r){this.#e?this.handleRecordingContextAction(e,r):this.handleSpyContextAction(e,r)}recordTestObject(e){this.emitEvent({type:"test-object-recorded",testObject:e})}recordAction(e,r){this.emitEvent({type:"actions-recorded",actions:[e],windowId:r})}async handleRecordingContextAction(e,r){const n=this.configs.clientManager.findClients({frameId:e.frameId,tabId:r.id})[0],s=n?.tabId,i=await n?.recorder.captureCurrentElement();if(i)switch(e.menuItemId){case L.CaptureObject:this.recordTestObject(i);break;case L.MouseOver:this.recordAction({command:h.HOVER,target:i},s);break;case L.VerifyElementText:let o=i.text;const c=i.tag?.toLowerCase().startsWith("flt-");!o&&c&&(o=i.attributes?.["aria-label"]||""),this.recordAction({command:h.VERIFY_ELEMENT_TEXT,target:i,parameters:[o]},s);break;case L.VerifyElementPresent:this.recordAction({command:h.VERIFY_ELEMENT_PRESENT,target:i},s);break;case L.VerifyElementNotPresent:this.recordAction({command:h.VERIFY_ELEMENT_NOT_PRESENT,target:i},s);break;case L.VerifyElementVisible:this.recordAction({command:h.VERIFY_ELEMENT_VISIBLE,target:i},s);break;case L.VerifyElementNotVisible:this.recordAction({command:h.VERIFY_ELEMENT_NOT_VISIBLE,target:i},s);break;case L.VerifyElementClickable:this.recordAction({command:h.VERIFY_ELEMENT_CLICKABLE,target:i},s);break;case L.VerifyElementNotClickable:this.recordAction({command:h.VERIFY_ELEMENT_NOT_CLICKABLE,target:i},s);break;case L.WaitForElementPresent:this.recordAction({command:h.WAIT_FOR_ELEMENT_PRESENT,target:i},s);break;case L.WaitForElementNotPresent:this.recordAction({command:h.WAIT_FOR_ELEMENT_NOT_PRESENT,target:i},s);break;case L.WaitForElementVisible:this.recordAction({command:h.WAIT_FOR_ELEMENT_VISIBLE,target:i},s);break;case L.WaitForElementNotVisible:this.recordAction({command:h.WAIT_FOR_ELEMENT_NOT_VISIBLE,target:i},s);break}}async handleSpyContextAction(e,r){const s=await this.configs.clientManager.findClients({frameId:e.frameId,tabId:r.id})[0]?.recorder.captureCurrentElement();if(s)switch(e.menuItemId){case ar.CaptureObject:this.recordTestObject(s);break}}}async function cr(t,e){await Promise.allSettled(t.map(async r=>{r.transport&&!r.transport.isConnected||await e(r)}))}class bi extends it{#e=new ts;constructor(){super(),this.handlePageRecorderEvent=this.handlePageRecorderEvent.bind(this),this.handleClientConnected=this.handleClientConnected.bind(this),this.handleClientDisconnected=this.handleClientDisconnected.bind(this)}async start(){await this.stop();const e=this.configs.clientManager.findClients();await cr(e,async r=>{await this.setupClient(r)}),this.configs.clientManager.on("client-connected",this.handleClientConnected),this.configs.clientManager.on("client-disconnected",this.handleClientDisconnected)}async stop(){this.configs.clientManager.off("client-connected",this.handleClientConnected),this.configs.clientManager.off("client-disconnected",this.handleClientDisconnected),await this.#e.removeAllListeners();const e=this.configs.clientManager.findClients();await cr(e,async r=>{try{await r.recorder.stop()}catch(n){console.warn("Failed to stop recording for client",r,n)}})}handleClientConnected(e){this.setupClient(e.client)}async setupClient(e){const r=this.configs.mode===D.RECORD;try{r?(await this.#e.with(e.recorder).on("actions",this.handlePageRecorderEvent.bind(this,e)),await e.recorder.startRecording()):(await this.#e.with(e.recorder).on("test-object-captured",this.handlePageRecorderEvent.bind(this,e)),await e.recorder.startSpying())}catch(n){console.warn("Failed to start recording for client",e,n)}}async handleClientDisconnected(e){try{await e.client.recorder.stop()}catch{}}handlePageRecorderEvent(e,r){switch(r.type){case"actions":this.emitEvent({type:"actions-recorded",actions:r.actions,windowId:e.tabId});break;case"test-object-captured":this.emitEvent({type:"test-object-recorded",testObject:r.testObject});break}}}class Ai extends z{constructor(e){super(),this.ksTransport=e}ksVersion="";browserName="";highlightElementProvider=null;takeScreenshotElementProvider=null;#e=new Bs({autoRetry:!0,retryInterval:1e3});async start(){const e=this.ksTransport;e.addMessageListener(r=>{const n=r.message;this.handleKSMessage(n,e)}),e.on("disconnected",()=>{this.stop()}),this.#e.addTransport(e),this.#e.run()}async stop(){this.emit("stop")}async sendBrowserInfo(){return this.#t(e=>{e.sendMessage({command:q.BROWSER_INFO,data:{browserName:Ze.getBrowserName()==="Microsoft Edge"?"Edge Chromium":Ze.getBrowserName(),version:this.ksVersion}}),e.sendRawMessage("SELENIUM_SOCKET=true")})}handleKSMessage(e,r){switch(e.command){case q.REQUEST_BROWSER_INFO:{this.ksVersion=e.data&&e.data.currentVersionString?e.data.currentVersionString:"",this.sendBrowserInfo();break}case q.RECORDER_SETTING:{const s={excludePattern:e.data&&e.data.exclusionPattern?e.data.exclusionPattern:""};this.emit({type:"recorder-setting",setting:s});break}case q.START_RECORD:{this.emit("start-recording");break}case q.START_INSPECT:{this.emit("start-spying");break}case q.HIGHLIGHT_OBJECT:{const n=e.data.selectorMethod,s=e.data.locator;this.highlightElementProvider?.(n,s).then(i=>{i?this.showHighlightElementInfo(i):(console.warn(`Element with locator "${s}" not found for highlighting.`),this.showHighlightElementInfo(0))}).catch(i=>{console.error("Error highlighting element:",i),this.showHighlightElementInfo(0)});break}case q.TAKE_SCREENSHOT_OBJECT:{const n=e.data.path,s=e.data.name,i=e.data.locator;this.takeScreenshotElementProvider?.(i).then(o=>{this.#t(c=>{const l=te({path:n,name:s,base64:o});c.sendRawMessage(`screenshotObjectInfo=${l}`)})}).catch(o=>{console.error("Error taking screenshot:",o),this.#t(c=>{const l=te({path:n,name:s,base64:""});c.sendRawMessage(`screenshotObjectInfo=${l}`)})});break}}}#t(e){if(this.ksTransport?.isConnected)return e(this.ksTransport)}async recordTestObject(e){return this.#t(r=>{const n=te(Pe(e)),s=encodeURIComponent(n);r.sendRawMessage(`element=${s}`)})}async recordActions(e,r){return this.#t(n=>{for(const s of e){const i=te(ci(s,r)),o=encodeURIComponent(i);n.sendRawMessage(`elementAction=${o}`)}})}async showHighlightElementInfo(e){return this.#t(r=>{const n=te({found:e});r.sendRawMessage(`hightlightElementInfo=${n}`)})}}class vi extends z{clients=[];constructor(){super(),this.unregisterDisconnectedClients=this.unregisterDisconnectedClients.bind(this)}findClients(e){return e?this.clients.filter(r=>(!r.transport||r.transport.isConnected)&&(e.tabId!==void 0?r.tabId===e.tabId:!0)&&(e.frameId!==void 0?r.frameId===e.frameId:!0)):this.clients.slice()}unregisterDisconnectedClients(){this.clients=this.clients.filter(e=>{const r=!e.transport||e.transport.isConnected;return r||this.unregisterClient(e),r})}registerClient(e){this.clients.push(e),e.transport?.once("disconnected",this.unregisterDisconnectedClients),this.emitEvent({type:"client-connected",client:e})}unregisterClient(e){this.clients=this.clients.filter(r=>r!==e),e.transport?.off("disconnected",this.unregisterDisconnectedClients),this.emitEvent({type:"client-disconnected",client:e})}}class Ti extends z{#e=!1;#t=!1;actionProviders=[];clientManager=new vi;constructor(){super(),this.handleActionProviderEvent=this.handleActionProviderEvent.bind(this)}registerActionProvider(e){this.actionProviders.push(e)}unregisterActionProvider(e){this.actionProviders=this.actionProviders.filter(r=>r!==e)}async loadActionProviders(){await Promise.allSettled(this.actionProviders.map(async e=>{try{e.on("*",this.handleActionProviderEvent),await this.configActionProvider(e),await e.start()}catch(r){console.warn("Failed to start action provider",e,r)}}))}async configActionProvider(e){await e.config({clientManager:this.clientManager,mode:this.#e?D.RECORD:D.SPY})}async unloadActionProviders(){await Promise.allSettled(this.actionProviders.map(async e=>{try{e.off("*",this.handleActionProviderEvent),await this.configActionProvider(e),await e.stop()}catch(r){console.warn("Failed to stop action provider",e,r)}}))}async reloadActionProviders(){await this.unloadActionProviders(),await this.loadActionProviders()}handleActionProviderEvent(e){switch(e.type){case"actions-recorded":this.emitEvent({type:"actions-recorded",actions:e.actions,windowId:e.windowId});break;case"test-object-recorded":this.emitEvent({type:"test-object-recorded",testObject:e.testObject});break}}isRecording(){return this.#e}isSpying(){return this.#t}async startRecording(){this.#e||(this.#e=!0,this.#t=!1,await this.reloadActionProviders().catch(e=>{console.warn(e)}),this.emitEvent({type:"start-recording"}))}async startSpying(){this.#t||(this.#t=!0,this.#e=!1,await this.reloadActionProviders().catch(e=>{console.warn(e)}),this.emitEvent({type:"start-spying"}))}async stop(){this.#e=!1,this.#t=!1,this.emitEvent({type:"stop"}),await this.unloadActionProviders().catch(e=>{console.warn(e)})}async highlightElement(e,r){const n=await _.tabs.query({active:!0,lastFocusedWindow:!0});if(n.length===0)return console.log("No active tab found. Cannot highlight element."),null;const s=n[0];if(!s||s.id===void 0||s.windowId===void 0)return console.log("No focused tab found. Cannot highlight element."),null;const i=this.clientManager.clients.filter(o=>o.transport&&o.transport.isConnected&&o.tabId===s.id)[0];return i?i.recorder.highlightElement(e,r):(console.log("No active client found for the current tab. Cannot highlight element."),null)}async recordTestObject(e){this.emitEvent({type:"test-object-recorded",testObject:e})}async recordActions(e,r){this.emitEvent({type:"actions-recorded",actions:e,windowId:r})}async takeScreenshotElement(e){const r=await _.tabs.query({active:!0,lastFocusedWindow:!0});if(r.length===0)return console.log("No active tab found. Cannot take screenshot for element."),null;const n=r[0];if(!n||n.id===void 0||n.windowId===void 0)return console.log("No focused tab found. Cannot take screenshot for element."),null;const s=this.clientManager.clients.filter(c=>c.transport&&c.transport.isConnected&&c.tabId===n.id)[0];if(!s)return console.log("No active client found for the current tab. Cannot take screenshot."),null;if(await s.recorder.checkAndScrollToElement(e)===!1)return console.error(`Element with locator "${e}" not found.`),null;const o=await _.tabs.captureVisibleTab(n.windowId,{format:"png"});return _.runtime.lastError||!o?(console.error("Failed to capture browser tab:",_.runtime.lastError?.message),null):s.recorder.takeScreenshotElement(o,e)}}const _i=({params:t})=>{t.ksRecorder=new Ai(t.ksTransport),t.ksRecorder.browserName=Ze.getBrowserName()},yi=async()=>{const t=_.runtime.getURL("chrome_variables_init.js"),r=await(await fetch(t)).text(),[,n]=r.match(/katalonServerPort\s*=\s*'(\d+)'/m)||[];return n||5e4};var O=(t=>(t.EXTENSION_MODE="extension.mode",t.RECORDING_MODE="recording.mode",t.SMART_LOCATOR="locator.smart_locator",t.OPENAI_API_KEY="openai.api_key",t.OPENAI_MODEL="openai.model",t.MINIFY_PAYLOAD="assistant.minify_payload",t.PREDICTION_PROMPT="assistant.prediction_prompt",t.LOCATOR_GENERATION_PROMPT="assistant.locator_generation_prompt",t.TEST_DATA_GENERATION_PROMPT="assistant.test_data_generation_prompt",t.EXCLUSION_PATTERN="recording.exclusion_patterns",t.KS_RECORDER_PORT="recording.ks_recorder_port",t))(O||{});const wi=({params:t})=>{const e="127.0.0.1",r=new Ys({server:`ws://${e}:${t.ksPort}`,timeout:5e3});r.on("error",async()=>{const s=await t.settingsService.get(O.KS_RECORDER_PORT);if(s&&s!==t.ksPort){r.server=`ws://${e}:${s}`,console.log("KSPort connection error, trying to use the port from settings...",s,r.server);return}const i=await yi();i&&(console.log("KSPort connection error, trying to fetch the port from the js config file...",i,r.server),r.server=`ws://${e}:${i}`)}),t.ksTransport=r},Ri=({params:t})=>{t.recorderController=new Ti},Si=({params:t})=>{t.transportServer=new Gs},Ni=({params:t})=>{const{ksRecorder:e,recorderController:r,settingsService:n}=t;e.on("recorder-setting",({setting:s})=>{n.set(O.EXCLUSION_PATTERN,s.excludePattern)}),e.on("start-recording",()=>{r.startRecording()}),e.on("start-spying",()=>{r.startSpying()}),e.on("stop",()=>{r.stop()}),e.highlightElementProvider=async(s,i)=>r.highlightElement(s,i),e.takeScreenshotElementProvider=async s=>r.takeScreenshotElement(s)},Ci=({params:t})=>{const{recorderController:e,ksRecorder:r}=t;e.clientManager=t.clientManager||e.clientManager,e.on("test-object-recorded",n=>{r.recordTestObject(n.testObject)}),e.on("actions-recorded",n=>{r.recordActions(n.actions,n.windowId)}),e.on("highlight-element-info",n=>{r.showHighlightElementInfo(n.found)}),t.actionProviders.forEach(n=>{e.registerActionProvider(n)})},Mi=({params:t})=>{t.ksRecorder.start()};class Li extends Is{constructor(){super(),this.registerPreHandler(wi),this.registerPreHandler(_i),this.registerPreHandler(Ri),this.registerPreHandler(Si),this.registerAfterPreHandler(({params:e})=>{e.actionProviders=this.getActionProviders()}),this.registerBeforeMainHandler(Ni),this.registerBeforeMainHandler(Ci),this.registerMainHandler(Mi)}getActionProviders(){return[]}}const xi=({params:t})=>{const{transportServer:e,recorderController:r,settingsService:n}=t;e.addConnectionListener(s=>{switch(s.transport.name){case ue.PageRecorderTransportName:{const i=P.attachToClient({},s,ue.PageRecorderChannel),o=s.transport.port.sender,c=new ui(o?.tab?.windowId,o?.tab?.id,o?.frameId,i,s);r.clientManager.registerClient(c);const l=P.attachToServer(n,s,ue.SettingsServiceChannel);s.once("disconnected",()=>{r.clientManager.unregisterClient(c),P.detachFromClient(i),l()});break}case ue.PopupTransportName:{const i=P.attachToServer(n,s,ue.SettingsServiceChannel);s.once("disconnected",()=>{i()});break}}})},Pi=({params:t})=>{t.transportServer.listen()},Oi=async({params:t})=>{await t.settingsService.subscribe(O.RECORDING_MODE,r=>{r===D.RECORD?t.recorderController.startRecording():r===D.SPY?t.recorderController.startSpying():r===D.AUTO&&(t.ksTransport.isConnected||t.recorderController.stop())})},Ii={[O.SMART_LOCATOR]:!0,[O.OPENAI_MODEL]:"gpt-4o-mini",[O.MINIFY_PAYLOAD]:!0,[O.EXCLUSION_PATTERN]:"",[O.PREDICTION_PROMPT]:`Please detect the main automation test flows as make sense as possible on the HTML page below for testing purposes and "{description}". Try to group related steps into the same flow.
{schema}

The HTML content is as below:
{html}`,[O.LOCATOR_GENERATION_PROMPT]:`Please generate a more stable, reliable, and simpler locator for the element pointed by this locator "{locator}" on the HTML page below for testing purposes and "{description}". Try to detect the CSS selector as accurately as possible.
{schema}

The HTML content is :
{html}`,[O.TEST_DATA_GENERATION_PROMPT]:`Please generate a few test data for the input/textarea tag below for testing purpose and "{description}".
{schema}

The HTML content is :
{inputHTML}`,[O.KS_RECORDER_PORT]:"50000"};class ki extends ti{defaultSettings=Ii;get storage(){return _.storage.local}async get(e){const n=(await this.storage.get(e))[e];return this.resolveValue(e,n)}async set(e,r){await this.get(e)!==r&&(await this.storage.set({[e]:r}),this.emit("change",{key:e,value:this.resolveValue(e,r)}))}async remove(e){await this.storage.remove(e),this.emit("change",{key:e,value:this.resolveValue(e)})}resolveValue(e,r){return(r===void 0||r==="")&&this.defaultSettings[e]!==null?this.defaultSettings[e]:r}async registerDefaultSettings(e,r){typeof e=="object"?Object.assign(this.defaultSettings,e):this.defaultSettings[e]=r}async unregisterDefaultSettings(e){delete this.defaultSettings[e]}}const Fi=async({params:t})=>{t.settingsService=new ki};class Vi extends Li{constructor(){super(),this.registerAfterPreHandler(ri),this.registerAfterPreHandler(si),this.registerAfterPreHandler(ni),this.registerAfterPreHandler(Fi),this.registerBeforeMainHandler(xi),this.registerMainHandler(Pi),this.registerAfterMainHandler(Oi)}getActionProviders(){return[new bi,new Ei,new gi]}}function Di(){(nt.extensionMode===rt.FULL||nt.extensionMode===rt.HYBRID)&&new Vi().run({params:{ksPort:nt.ksPort}})}function Hi(){console.log("> Background script loaded"),Di(),Zs()}Hi()})();
